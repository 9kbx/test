import{K as H,aG as me,r as N,a1 as we,k as he,a0 as ve,ak as g,au as $,o as s,a as O,Y as e,S as t,ac as q,T as j,R as d,W as r,V as b,b as M,u as T,X as x}from"./vue.e20a9695.js";import{e as U,g as m,G as ke,f as A,E as k}from"./index.a169e15e.js";import{J as P,_ as Je}from"./editJobDetail.vue_vue_type_script_setup_true_name_sysEditJobDetail_lang.34a50336.js";import{_ as De}from"./editJobTrigger.vue_vue_type_script_setup_true_name_sysEditJobTrigger_lang.ccc0fadd.js";import{_ as je}from"./jobCluster.vue_vue_type_script_setup_true_lang.444da94f.js";import{S as w}from"./sys-job-api.57e42005.js";import"./monacoEditor.48edecf2.js";import"./index.b45c2b37.js";import"./second.4fa9559a.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./min.449aa3c7.js";import"./hour.92f202f4.js";import"./day.14e5dbb7.js";import"./month.92d9259f.js";import"./week.fbe6f086.js";import"./year.b1bfe83b.js";import"./result.vue_vue_type_script_setup_true_lang.36186e62.js";const Te={class:"sys-job-container"},xe={style:{display:"flex","align-items":"center"}},Pe={style:{"margin-left":"5px"}},Ce={key:0},Se={key:1,style:{"text-align":"center"}},Ie=H({name:"sysJob"}),Xe=H({...Ie,setup(ze){const K=me(),D=N(),S=N(),V=N(),p=we({loading:!1,jobData:[],queryParams:{jobId:void 0,description:void 0},tableParams:{page:1,pageSize:10,total:0},editJobDetailTitle:"",editJobTriggerTitle:""});he(async()=>{h(),U.on("submitRefresh",()=>{h()})}),ve(()=>{U.off("submitRefresh")});const h=async()=>{var c,v;p.loading=!0;let o=Object.assign(p.queryParams,p.tableParams);var a=await m(w).apiSysJobPageJobDetailPost(o);p.jobData=((c=a.data.result)==null?void 0:c.items)??[],p.tableParams.total=(v=a.data.result)==null?void 0:v.total,p.loading=!1},G=()=>{p.queryParams.jobId=void 0,p.queryParams.description=void 0,h()},F=()=>{var o;p.editJobDetailTitle="添加作业",(o=D.value)==null||o.openDialog({concurrent:!0,includeAnnotations:!0,groupName:"default",createType:P.NUMBER_2})},Q=o=>{var a;p.editJobDetailTitle="编辑作业",(a=D.value)==null||a.openDialog(o.jobDetail)},W=o=>{var a;A.confirm(`确定删除作业：【${(a=o.jobDetail)==null?void 0:a.jobId}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{var c;await m(w).apiSysJobDeleteJobDetailPost({jobId:(c=o.jobDetail)==null?void 0:c.jobId}),h(),k.success("删除成功")}).catch(()=>{})},X=o=>{var a,c;p.editJobTriggerTitle="添加触发器",(c=S.value)==null||c.openDialog({jobId:(a=o.jobDetail)==null?void 0:a.jobId,retryTimeout:1e3,startNow:!0,runOnStart:!0,resetOnlyOnce:!0,triggerType:"Furion.Schedule.PeriodTrigger"})},Y=o=>{var a;p.editJobTriggerTitle="编辑触发器",(a=S.value)==null||a.openDialog(o)},L=o=>{A.confirm(`确定删除触发器：【${o.triggerId}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await m(w).apiSysJobDeleteJobTriggerPost({jobId:o.jobId,triggerId:o.triggerId}),h(),k.success("删除成功")}).catch(()=>{})},Z=o=>{p.tableParams.pageSize=o,h()},ee=o=>{p.tableParams.page=o,h()},te=async()=>{await m(w).apiSysJobStartAllJobPost(),k.success("启动所有作业")},oe=async()=>{await m(w).apiSysJobPauseAllJobPost(),k.success("暂停所有作业")},le=async o=>{var a;await m(w).apiSysJobStartJobPost({jobId:(a=o.jobDetail)==null?void 0:a.jobId}),k.success("启动作业")},ae=async o=>{var a;await m(w).apiSysJobPauseJobPost({jobId:(a=o.jobDetail)==null?void 0:a.jobId}),k.success("暂停作业")},ie=async o=>{await m(w).apiSysJobStartTriggerPost({jobId:o.jobId,triggerId:o.triggerId}),k.success("启动触发器")},re=async o=>{await m(w).apiSysJobPauseTriggerPost({jobId:o.jobId,triggerId:o.triggerId}),k.success("暂停触发器")},ne=async()=>{await m(w).apiSysJobCancelSleepPost(),k.success("强制唤醒作业调度器")},se=async()=>{await m(w).apiSysJobPersistAllPost(),k.success("强制触发所有作业持久化")},pe=()=>{var o;(o=V.value)==null||o.openDrawer()},de=()=>{K.push({path:"/platform/job/dashboard"})},I=o=>{if(o==null||o==="")return{};const a=JSON.parse(o),c=JSON.parse(a.HttpJob);return{requestUri:c.RequestUri,httpMethod:JSON.stringify(c.HttpMethod),body:c.Body}},ue=o=>{var a,c;if(o==null||o==="")return"";for(const v in(a=D.value)==null?void 0:a.httpMethodDef)if(((c=D.value)==null?void 0:c.httpMethodDef[v])===o)return v;return""};return(o,a)=>{const c=g("el-input"),v=g("el-form-item"),f=g("el-button"),z=g("el-button-group"),y=g("el-tooltip"),ce=g("el-form"),B=g("el-card"),i=g("el-table-column"),u=g("el-tag"),E=g("el-table"),fe=g("el-icon"),R=g("el-descriptions-item"),be=g("el-descriptions"),ge=g("el-popover"),ye=g("el-pagination"),C=$("auth"),_e=$("loading");return s(),O("div",Te,[e(B,{shadow:"hover","body-style":{paddingBottom:"0"}},{default:t(()=>[e(ce,{model:p.queryParams,ref:"queryForm",inline:!0},{default:t(()=>[e(v,{label:"作业编号",prop:"jobId"},{default:t(()=>[e(c,{placeholder:"作业编号",clearable:"",onKeyup:q(h,["enter"]),modelValue:p.queryParams.jobId,"onUpdate:modelValue":a[0]||(a[0]=n=>p.queryParams.jobId=n)},null,8,["onKeyup","modelValue"])]),_:1}),e(v,{label:"描述信息",prop:"description"},{default:t(()=>[e(c,{placeholder:"描述信息",clearable:"",onKeyup:q(h,["enter"]),modelValue:p.queryParams.description,"onUpdate:modelValue":a[1]||(a[1]=n=>p.queryParams.description=n)},null,8,["onKeyup","modelValue"])]),_:1}),e(v,null,{default:t(()=>[e(z,null,{default:t(()=>[j((s(),d(f,{type:"primary",icon:"ele-Search",onClick:h},{default:t(()=>[r(" 查询 ")]),_:1})),[[C,"sysJob:pageJobDetail"]]),e(f,{icon:"ele-Refresh",onClick:G},{default:t(()=>[r(" 重置 ")]),_:1})]),_:1})]),_:1}),e(v,null,{default:t(()=>[e(z,{style:{margin:"0px 12px"}},{default:t(()=>[e(y,{content:"增加作业"},{default:t(()=>[j(e(f,{icon:"ele-CirclePlus",onClick:F},null,512),[[C,"sysJob:addJobDetail"]])]),_:1}),e(y,{content:"启动所有作业"},{default:t(()=>[e(f,{icon:"ele-VideoPlay",onClick:te})]),_:1}),e(y,{content:"暂停所有作业"},{default:t(()=>[e(f,{icon:"ele-VideoPause",onClick:oe})]),_:1})]),_:1}),e(z,{style:{margin:"0px 12px 0px 0px"}},{default:t(()=>[e(y,{content:"强制唤醒作业调度器"},{default:t(()=>[e(f,{icon:"ele-AlarmClock",onClick:ne})]),_:1}),e(y,{content:"强制触发所有作业持久化"},{default:t(()=>[e(f,{icon:"ele-Connection",onClick:se})]),_:1})]),_:1}),e(f,{icon:"ele-Coin",onClick:pe,plain:""},{default:t(()=>[r(" 集群控制 ")]),_:1}),e(f,{icon:"ele-Grid",onClick:de,plain:""},{default:t(()=>[r(" 任务看板 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(B,{shadow:"hover",style:{"margin-top":"8px"}},{default:t(()=>[j((s(),d(E,{data:p.jobData,style:{width:"100%"},border:""},{default:t(()=>[e(i,{type:"expand",fixed:""},{default:t(n=>[e(E,{style:{"margin-left":"48px",width:"calc(100% - 48px)"},data:n.row.jobTriggers,border:"",size:"small"},{default:t(()=>[e(i,{type:"index",label:"序号",width:"55",align:"center",fixed:""}),e(i,{prop:"triggerId",label:"触发器编号",width:"120",fixed:"","show-overflow-tooltip":""}),e(i,{prop:"triggerType",label:"类型","show-overflow-tooltip":""}),e(i,{prop:"args",label:"参数","show-overflow-tooltip":""}),e(i,{prop:"description",label:"描述",width:"120","show-overflow-tooltip":""}),e(i,{prop:"status",label:"状态",width:"100",align:"center","show-overflow-tooltip":""},{default:t(l=>[l.row.status==0?(s(),d(u,{key:0,type:"warning",effect:"plain"},{default:t(()=>[r(" 积压 ")]),_:1})):b("",!0),l.row.status==1?(s(),d(u,{key:1,type:"",effect:"plain"},{default:t(()=>[r(" 就绪 ")]),_:1})):b("",!0),l.row.status==2?(s(),d(u,{key:2,type:"success",effect:"plain"},{default:t(()=>[r(" 正在运行 ")]),_:1})):b("",!0),l.row.status==3?(s(),d(u,{key:3,type:"danger",effect:"plain"},{default:t(()=>[r(" 暂停 ")]),_:1})):b("",!0),l.row.status==4?(s(),d(u,{key:4,type:"danger",effect:"plain"},{default:t(()=>[r(" 阻塞 ")]),_:1})):b("",!0),l.row.status==5?(s(),d(u,{key:5,type:"",effect:"plain"},{default:t(()=>[r(" 由失败进入就绪 ")]),_:1})):b("",!0),l.row.status==6?(s(),d(u,{key:6,type:"danger",effect:"plain"},{default:t(()=>[r(" 归档 ")]),_:1})):b("",!0),l.row.status==7?(s(),d(u,{key:7,type:"danger",effect:"plain"},{default:t(()=>[r(" 崩溃 ")]),_:1})):b("",!0),l.row.status==8?(s(),d(u,{key:8,type:"danger",effect:"plain"},{default:t(()=>[r(" 超限 ")]),_:1})):b("",!0),l.row.status==9?(s(),d(u,{key:9,type:"danger",effect:"plain"},{default:t(()=>[r(" 无触发时间 ")]),_:1})):b("",!0),l.row.status==10?(s(),d(u,{key:10,type:"danger",effect:"plain"},{default:t(()=>[r(" 未启动 ")]),_:1})):b("",!0),l.row.status==11?(s(),d(u,{key:11,type:"danger",effect:"plain"},{default:t(()=>[r(" 未知作业触发器 ")]),_:1})):b("",!0),l.row.status==12?(s(),d(u,{key:12,type:"danger",effect:"plain"},{default:t(()=>[r(" 未知作业处理程序 ")]),_:1})):b("",!0)]),_:2},1024),e(i,{prop:"startTime",label:"起始时间",width:"100",align:"center","show-overflow-tooltip":""}),e(i,{prop:"endTime",label:"结束时间",width:"100",align:"center","show-overflow-tooltip":""}),e(i,{prop:"lastRunTime",label:"最近运行时间",width:"140",align:"center","show-overflow-tooltip":""}),e(i,{prop:"nextRunTime",label:"下一次运行时间",width:"140",align:"center","show-overflow-tooltip":""}),e(i,{prop:"numberOfRuns",label:"触发次数",width:"100",align:"center","show-overflow-tooltip":""}),e(i,{prop:"maxNumberOfRuns",label:"最大触发次数",width:"120",align:"center","show-overflow-tooltip":""}),e(i,{prop:"numberOfErrors",label:"出错次数",width:"100",align:"center","show-overflow-tooltip":""}),e(i,{prop:"maxNumberOfErrors",label:"最大出错次数",width:"120",align:"center","show-overflow-tooltip":""}),e(i,{prop:"numRetries",label:"重试次数",width:"100",align:"center","show-overflow-tooltip":""}),e(i,{prop:"retryTimeout",label:"重试间隔ms",width:"100",align:"center","show-overflow-tooltip":""}),e(i,{prop:"startNow",label:"是否立即启动",width:"100",align:"center","show-overflow-tooltip":""},{default:t(l=>[l.row.startNow==!0?(s(),d(u,{key:0},{default:t(()=>[r(" 是 ")]),_:1})):(s(),d(u,{key:1,type:"info"},{default:t(()=>[r(" 否 ")]),_:1}))]),_:2},1024),e(i,{prop:"runOnStart",label:"是否启动时执行一次",width:"150",align:"center","show-overflow-tooltip":""},{default:t(l=>[l.row.runOnStart==!0?(s(),d(u,{key:0},{default:t(()=>[r(" 是 ")]),_:1})):(s(),d(u,{key:1,type:"info"},{default:t(()=>[r(" 否 ")]),_:1}))]),_:2},1024),e(i,{prop:"resetOnlyOnce",label:"是否重置触发次数",width:"120",align:"center","show-overflow-tooltip":""},{default:t(l=>[l.row.resetOnlyOnce==!0?(s(),d(u,{key:0},{default:t(()=>[r(" 是 ")]),_:1})):(s(),d(u,{key:1,type:"info"},{default:t(()=>[r(" 否 ")]),_:1}))]),_:2},1024),e(i,{prop:"updatedTime",label:"更新时间",width:"140",align:"center","show-overflow-tooltip":""}),e(i,{label:"操作",width:"140",align:"center","show-overflow-tooltip":"",fixed:"right"},{default:t(l=>[e(y,{content:"启动触发器"},{default:t(()=>[e(f,{size:"small",type:"primary",icon:"ele-VideoPlay",text:"",onClick:J=>ie(l.row)},null,8,["onClick"])]),_:2},1024),e(y,{content:"暂停触发器"},{default:t(()=>[e(f,{size:"small",type:"primary",icon:"ele-VideoPause",text:"",onClick:J=>re(l.row)},null,8,["onClick"])]),_:2},1024),e(y,{content:"编辑触发器"},{default:t(()=>[e(f,{size:"small",type:"primary",icon:"ele-Edit",text:"",onClick:J=>Y(l.row)},null,8,["onClick"])]),_:2},1024),e(y,{content:"删除触发器"},{default:t(()=>[e(f,{size:"small",type:"danger",icon:"ele-Delete",text:"",onClick:J=>L(l.row)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["data"])]),_:1}),e(i,{type:"index",label:"序号",width:"55",align:"center",fixed:""}),e(i,{prop:"jobDetail.jobId",label:"作业编号",width:"180",fixed:""},{default:t(n=>{var l;return[M("div",xe,[e(fe,null,{default:t(()=>[e(T(ke))]),_:1}),M("span",Pe,x((l=n.row.jobDetail)==null?void 0:l.jobId),1)])]}),_:1}),e(i,{prop:"jobDetail.groupName",label:"组名称",width:"100","show-overflow-tooltip":""}),e(i,{prop:"jobDetail.jobType",label:"类型","show-overflow-tooltip":""}),e(i,{prop:"jobDetail.description",label:"描述","show-overflow-tooltip":""}),e(i,{prop:"jobDetail.concurrent",label:"执行方式",width:"90",align:"center","show-overflow-tooltip":""},{default:t(n=>{var l;return[((l=n.row.jobDetail)==null?void 0:l.concurrent)==!0?(s(),d(u,{key:0,type:"success"},{default:t(()=>[r(" 并行 ")]),_:1})):(s(),d(u,{key:1,type:"warning"},{default:t(()=>[r(" 串行 ")]),_:1}))]}),_:1}),e(i,{prop:"jobDetail.createType",label:"作业创建类型",width:"110",align:"center","show-overflow-tooltip":""},{default:t(n=>{var l,J,_;return[((l=n.row.jobDetail)==null?void 0:l.createType)==T(P).NUMBER_0?(s(),d(u,{key:0,type:"info"},{default:t(()=>[r(" 内置 ")]),_:1})):b("",!0),((J=n.row.jobDetail)==null?void 0:J.createType)==T(P).NUMBER_1?(s(),d(u,{key:1,type:"warning"},{default:t(()=>[r(" 脚本 ")]),_:1})):b("",!0),((_=n.row.jobDetail)==null?void 0:_.createType)==T(P).NUMBER_2?(s(),d(u,{key:2,type:"success"},{default:t(()=>[r(" HTTP请求 ")]),_:1})):b("",!0)]}),_:1}),e(i,{prop:"jobDetail.properties",label:"额外数据","show-overflow-tooltip":""},{default:t(n=>{var l,J;return[((l=n.row.jobDetail)==null?void 0:l.createType)!=T(P).NUMBER_2?(s(),O("span",Ce,x((J=n.row.jobDetail)==null?void 0:J.properties),1)):(s(),O("div",Se,[e(ge,{placement:"left",width:400,trigger:"hover"},{reference:t(()=>[e(u,{effect:"plain",type:"info"},{default:t(()=>[r(" 请求参数 ")]),_:1})]),default:t(()=>[e(be,{title:"Http 请求参数",column:1,size:"small",border:!0},{default:t(()=>[e(R,{label:"请求地址","label-align":"right","label-class-name":"job-index-descriptions-label-style"},{default:t(()=>{var _;return[r(x(I((_=n.row.jobDetail)==null?void 0:_.properties).requestUri),1)]}),_:2},1024),e(R,{label:"请求方法","label-align":"right","label-class-name":"job-index-descriptions-label-style"},{default:t(()=>{var _;return[r(x(ue(I((_=n.row.jobDetail)==null?void 0:_.properties).httpMethod)),1)]}),_:2},1024),e(R,{label:"请求报文体","label-align":"right","label-class-name":"job-index-descriptions-label-style"},{default:t(()=>{var _;return[r(x(I((_=n.row.jobDetail)==null?void 0:_.properties).body),1)]}),_:2},1024)]),_:2},1024)]),_:2},1024)]))]}),_:1}),e(i,{prop:"jobDetail.updatedTime",label:"更新时间",width:"160",align:"center","show-overflow-tooltip":""}),e(i,{label:"操作",width:"170",fixed:"right",align:"center","show-overflow-tooltip":""},{default:t(n=>[e(y,{content:"增加触发器"},{default:t(()=>[e(f,{size:"small",type:"primary",icon:"ele-CirclePlus",text:"",onClick:l=>X(n.row)},null,8,["onClick"])]),_:2},1024),e(y,{content:"启动作业"},{default:t(()=>[e(f,{size:"small",type:"primary",icon:"ele-VideoPlay",text:"",onClick:l=>le(n.row)},null,8,["onClick"])]),_:2},1024),e(y,{content:"暂停作业"},{default:t(()=>[e(f,{size:"small",type:"primary",icon:"ele-VideoPause",text:"",onClick:l=>ae(n.row)},null,8,["onClick"])]),_:2},1024),e(y,{content:"编辑作业"},{default:t(()=>[j(e(f,{size:"small",type:"primary",icon:"ele-Edit",text:"",onClick:l=>Q(n.row)},null,8,["onClick"]),[[C,"sysJob:updateJobDetail"]])]),_:2},1024),e(y,{content:"删除作业"},{default:t(()=>[j(e(f,{size:"small",type:"danger",icon:"ele-Delete",text:"",onClick:l=>W(n.row)},null,8,["onClick"]),[[C,"sysJob:deleteJobDetail"]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[_e,p.loading]]),e(ye,{currentPage:p.tableParams.page,"onUpdate:currentPage":a[2]||(a[2]=n=>p.tableParams.page=n),"page-size":p.tableParams.pageSize,"onUpdate:pageSize":a[3]||(a[3]=n=>p.tableParams.pageSize=n),total:p.tableParams.total,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:Z,onCurrentChange:ee,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])]),_:1}),e(Je,{ref_key:"editJobDetailRef",ref:D,title:p.editJobDetailTitle},null,8,["title"]),e(De,{ref_key:"editJobTriggerRef",ref:S,title:p.editJobTriggerTitle},null,8,["title"]),e(je,{ref_key:"editJobClusterRef",ref:V},null,512)])}}});export{Xe as default};
