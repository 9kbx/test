import{K as q,r as C,a1 as I,k as J,a0 as L,ak as l,au as k,o as s,a as O,Y as a,S as o,ac as x,T as p,R as m,W as u}from"./vue.e20a9695.js";import{e as b,f as P,z as S,E as W,J as Y}from"./index.b8a2e51c.js";import G from"./regionTree.a874c363.js";import{_ as H}from"./editRegion.vue_vue_type_script_setup_true_name_sysEditRegion_lang.6c05d392.js";import{S as v}from"./sys-region-api.7ded7263.js";import"./monacoEditor.48edecf2.js";import"./_plugin-vue_export-helper.c27b6911.js";const X={class:"sys-region-container"},Z=q({name:"sysRegion"}),se=q({...Z,setup(ee){const h=C(),w=C(),e=I({loading:!1,regionData:[],queryParams:{id:-1,pid:void 0,name:void 0,code:void 0},tableParams:{page:1,pageSize:10,total:0},editRegionTitle:""});J(()=>{r(),b.on("submitRefresh",async()=>{var t;r(),(t=w.value)==null||t.initTreeData()})}),L(()=>{b.off("submitRefresh")});const r=async()=>{var g,_;e.loading=!0;let t=Object.assign(e.queryParams,e.tableParams);var n=await P(v).apiSysRegionPagePost(t);e.regionData=((g=n.data.result)==null?void 0:g.items)??[],e.tableParams.total=(_=n.data.result)==null?void 0:_.total,e.loading=!1},z=()=>{e.queryParams.id=-1,e.queryParams.pid=void 0,e.queryParams.name=void 0,e.queryParams.code=void 0,r()},T=()=>{var t;e.editRegionTitle="添加行政区域",(t=h.value)==null||t.openDialog({})},D=t=>{var n;e.editRegionTitle="编辑行政区域",(n=h.value)==null||n.openDialog(t)},B=t=>{S.confirm(`确定删除行政区域：【${t.name}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await P(v).apiSysRegionDeletePost({id:t.id}),W.success("删除成功"),b.emit("submitRefresh")}).catch(()=>{})},V=async t=>{e.queryParams.pid=t.id,e.queryParams.name=void 0,e.queryParams.code=void 0,r()},E=async()=>{S.confirm("确认同步国家统计局行政区域数据？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{Y({title:"提示",message:"后台努力同步中...",type:"success",position:"bottom-right"}),await P(v).apiSysRegionSyncPost({timeout:1e3*60*30})}).catch(()=>{})},K=t=>{e.tableParams.pageSize=t,r()},N=t=>{e.tableParams.page=t,r()};return(t,n)=>{const g=l("el-col"),_=l("el-input"),y=l("el-form-item"),d=l("el-button"),U=l("el-button-group"),$=l("el-form"),R=l("el-card"),c=l("el-table-column"),A=l("el-table"),M=l("el-pagination"),j=l("el-row"),f=k("auth"),Q=k("loading");return s(),O("div",X,[a(j,{gutter:8,style:{width:"100%"}},{default:o(()=>[a(g,{span:6,xs:24},{default:o(()=>[a(G,{ref_key:"regionTreeRef",ref:w,onNodeClick:V},null,512)]),_:1}),a(g,{span:18,xs:24},{default:o(()=>[a(R,{shadow:"hover","body-style":{paddingBottom:"0"}},{default:o(()=>[a($,{model:e.queryParams,ref:"queryForm",inline:!0},{default:o(()=>[a(y,{label:"行政名称",prop:"name"},{default:o(()=>[a(_,{placeholder:"行政名称",clearable:"",onKeyup:x(r,["enter"]),modelValue:e.queryParams.name,"onUpdate:modelValue":n[0]||(n[0]=i=>e.queryParams.name=i)},null,8,["onKeyup","modelValue"])]),_:1}),a(y,{label:"行政代码",prop:"code"},{default:o(()=>[a(_,{placeholder:"行政代码",clearable:"",onKeyup:x(r,["enter"]),modelValue:e.queryParams.code,"onUpdate:modelValue":n[1]||(n[1]=i=>e.queryParams.code=i)},null,8,["onKeyup","modelValue"])]),_:1}),a(y,null,{default:o(()=>[a(U,null,{default:o(()=>[p((s(),m(d,{type:"primary",icon:"ele-Search",onClick:r},{default:o(()=>[u(" 查询 ")]),_:1})),[[f,"sysRegion:page"]]),a(d,{icon:"ele-Refresh",onClick:z},{default:o(()=>[u(" 重置 ")]),_:1})]),_:1})]),_:1}),a(y,null,{default:o(()=>[p((s(),m(d,{type:"primary",icon:"ele-Plus",onClick:T},{default:o(()=>[u(" 新增 ")]),_:1})),[[f,"sysRegion:add"]]),p((s(),m(d,{type:"danger",icon:"ele-Lightning",onClick:E},{default:o(()=>[u(" 同步统计局 ")]),_:1})),[[f,"sysRegion:sync"]])]),_:1})]),_:1},8,["model"])]),_:1}),a(R,{shadow:"hover",style:{"margin-top":"8px"}},{default:o(()=>[p((s(),m(A,{data:e.regionData,style:{width:"100%"},"row-key":"id","default-expand-all":"","tree-props":{children:"children",hasChildren:"hasChildren"},border:""},{default:o(()=>[a(c,{prop:"name",label:"行政名称","show-overflow-tooltip":""}),a(c,{prop:"code",label:"行政代码","show-overflow-tooltip":""}),a(c,{prop:"cityCode",label:"区号","show-overflow-tooltip":""}),a(c,{prop:"orderNo",label:"排序",width:"70",align:"center","show-overflow-tooltip":""}),a(c,{prop:"remark",label:"备注","show-overflow-tooltip":""}),a(c,{label:"操作",width:"140",fixed:"right",align:"center","show-overflow-tooltip":""},{default:o(i=>[p((s(),m(d,{icon:"ele-Edit",size:"small",text:"",type:"primary",onClick:F=>D(i.row)},{default:o(()=>[u(" 编辑 ")]),_:2},1032,["onClick"])),[[f,"sysRegion:update"]]),p((s(),m(d,{icon:"ele-Delete",size:"small",text:"",type:"danger",onClick:F=>B(i.row)},{default:o(()=>[u(" 删除 ")]),_:2},1032,["onClick"])),[[f,"sysRegion:delete"]])]),_:1})]),_:1},8,["data"])),[[Q,e.loading]]),a(M,{currentPage:e.tableParams.page,"onUpdate:currentPage":n[2]||(n[2]=i=>e.tableParams.page=i),"page-size":e.tableParams.pageSize,"onUpdate:pageSize":n[3]||(n[3]=i=>e.tableParams.pageSize=i),total:e.tableParams.total,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:K,onCurrentChange:N,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])]),_:1})]),_:1})]),_:1}),a(H,{ref_key:"editRegionRef",ref:h,title:e.editRegionTitle},null,8,["title"])])}}});export{se as default};
