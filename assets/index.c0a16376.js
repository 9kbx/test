import{K as V,r as R,a1 as I,k as W,a0 as Y,ak as r,au as k,o as i,a as H,Y as e,S as a,ac as C,T as g,R as d,W as s,V as J,u as S}from"./vue.e20a9695.js";import{e as x,g as D,f as L,E as X}from"./index.32ca2701.js";import{a as z}from"./authFunction.6d9e186f.js";import Z from"./editRole.81177238.js";import{_ as ee}from"./grantData.vue_vue_type_script_setup_true_name_sysGrantData_lang.d8c01441.js";import{S as q}from"./sys-role-api.7d9b1738.js";import"./monacoEditor.48edecf2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./orgTree.3bce14a2.js";import"./sys-org-api.bfa57671.js";const ae={class:"sys-role-container"},te=V({name:"sysRole"}),fe=V({...te,setup(oe){const y=R(),b=R(),t=I({loading:!1,roleData:[],queryParams:{name:void 0,code:void 0},tableParams:{page:1,pageSize:10,total:0},editRoleTitle:""});W(async()=>{p(),x.on("submitRefresh",()=>{p()})}),Y(()=>{x.off("submitRefresh")});const p=async()=>{var f,u;t.loading=!0;let n=Object.assign(t.queryParams,t.tableParams);var l=await D(q).apiSysRolePagePost(n);t.roleData=((f=l.data.result)==null?void 0:f.items)??[],t.tableParams.total=(u=l.data.result)==null?void 0:u.total,t.loading=!1},T=()=>{t.queryParams.name=void 0,t.queryParams.code=void 0,p()},B=()=>{var n;t.editRoleTitle="添加角色",(n=y.value)==null||n.openDialog({})},E=async n=>{var l;t.editRoleTitle="编辑角色",(l=y.value)==null||l.openDialog(n)},K=n=>{var l;(l=b.value)==null||l.openDialog(n)},U=n=>{L.confirm(`确定删角色：【${n.name}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await D(q).apiSysRoleDeletePost({id:n.id}),p(),X.success("删除成功")}).catch(()=>{})},$=n=>{t.tableParams.pageSize=n,p()},M=n=>{t.tableParams.page=n,p()};return(n,l)=>{const f=r("el-input"),u=r("el-form-item"),_=r("el-button"),N=r("el-button-group"),A=r("el-form"),h=r("el-card"),c=r("el-table-column"),m=r("el-tag"),v=r("el-dropdown-item"),j=r("el-dropdown-menu"),F=r("el-dropdown"),O=r("el-table"),Q=r("el-pagination"),w=k("auth"),G=k("loading");return i(),H("div",ae,[e(h,{shadow:"hover","body-style":{paddingBottom:"0"}},{default:a(()=>[e(A,{model:t.queryParams,ref:"queryForm",inline:!0},{default:a(()=>[e(u,{label:"角色名称",prop:"name"},{default:a(()=>[e(f,{placeholder:"角色名称",clearable:"",onKeyup:C(p,["enter"]),modelValue:t.queryParams.name,"onUpdate:modelValue":l[0]||(l[0]=o=>t.queryParams.name=o)},null,8,["onKeyup","modelValue"])]),_:1}),e(u,{label:"角色编码",prop:"code"},{default:a(()=>[e(f,{placeholder:"角色编码",clearable:"",onKeyup:C(p,["enter"]),modelValue:t.queryParams.code,"onUpdate:modelValue":l[1]||(l[1]=o=>t.queryParams.code=o)},null,8,["onKeyup","modelValue"])]),_:1}),e(u,null,{default:a(()=>[e(N,null,{default:a(()=>[g((i(),d(_,{type:"primary",icon:"ele-Search",onClick:p},{default:a(()=>[s(" 查询 ")]),_:1})),[[w,"sysRole:page"]]),e(_,{icon:"ele-Refresh",onClick:T},{default:a(()=>[s(" 重置 ")]),_:1})]),_:1})]),_:1}),e(u,null,{default:a(()=>[g((i(),d(_,{type:"primary",icon:"ele-Plus",onClick:B},{default:a(()=>[s(" 新增 ")]),_:1})),[[w,"sysRole:add"]])]),_:1})]),_:1},8,["model"])]),_:1}),e(h,{shadow:"hover",style:{"margin-top":"8px"}},{default:a(()=>[g((i(),d(O,{data:t.roleData,style:{width:"100%"},border:""},{default:a(()=>[e(c,{type:"index",label:"序号",width:"55",align:"center",fixed:""}),e(c,{prop:"name",label:"角色名称","show-overflow-tooltip":""}),e(c,{prop:"code",label:"角色编码","show-overflow-tooltip":""}),e(c,{label:"数据范围",align:"center","show-overflow-tooltip":""},{default:a(o=>[o.row.dataScope===1?(i(),d(m,{key:0,effect:"plain"},{default:a(()=>[s("全部数据")]),_:1})):o.row.dataScope===2?(i(),d(m,{key:1,effect:"plain"},{default:a(()=>[s("本部门及以下数据")]),_:1})):o.row.dataScope===3?(i(),d(m,{key:2,effect:"plain"},{default:a(()=>[s("本部门数据")]),_:1})):o.row.dataScope===4?(i(),d(m,{key:3,effect:"plain"},{default:a(()=>[s("仅本人数据")]),_:1})):o.row.dataScope===5?(i(),d(m,{key:4,effect:"plain"},{default:a(()=>[s("自定义数据")]),_:1})):J("",!0)]),_:1}),e(c,{prop:"orderNo",label:"排序",width:"70",align:"center","show-overflow-tooltip":""}),e(c,{label:"状态",width:"70",align:"center","show-overflow-tooltip":""},{default:a(o=>[o.row.status===1?(i(),d(m,{key:0,type:"success"},{default:a(()=>[s("启用")]),_:1})):(i(),d(m,{key:1,type:"danger"},{default:a(()=>[s("禁用")]),_:1}))]),_:1}),e(c,{prop:"createTime",label:"修改时间",align:"center","show-overflow-tooltip":""}),e(c,{prop:"remark",label:"备注","show-overflow-tooltip":""}),e(c,{label:"操作",width:"110",fixed:"right",align:"center","show-overflow-tooltip":""},{default:a(o=>[g((i(),d(_,{icon:"ele-Edit",size:"small",text:"",type:"primary",onClick:P=>E(o.row)},{default:a(()=>[s(" 编辑 ")]),_:2},1032,["onClick"])),[[w,"sysRole:update"]]),e(F,null,{dropdown:a(()=>[e(j,null,{default:a(()=>[e(v,{icon:"ele-OfficeBuilding",onClick:P=>K(o.row),disabled:!S(z)("sysRole:grantDataScope")},{default:a(()=>[s(" 数据范围 ")]),_:2},1032,["onClick","disabled"]),e(v,{icon:"ele-Delete",onClick:P=>U(o.row),divided:"",disabled:!S(z)("sysRole:delete")},{default:a(()=>[s(" 删除角色 ")]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),default:a(()=>[e(_,{icon:"ele-MoreFilled",size:"small",text:"",type:"primary",style:{"padding-left":"12px"}})]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[G,t.loading]]),e(Q,{currentPage:t.tableParams.page,"onUpdate:currentPage":l[2]||(l[2]=o=>t.tableParams.page=o),"page-size":t.tableParams.pageSize,"onUpdate:pageSize":l[3]||(l[3]=o=>t.tableParams.pageSize=o),total:t.tableParams.total,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:$,onCurrentChange:M,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])]),_:1}),e(Z,{ref_key:"editRoleRef",ref:y,title:t.editRoleTitle},null,8,["title"]),e(ee,{ref_key:"grantDataRef",ref:b},null,512)])}}});export{fe as default};
