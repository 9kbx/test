import{f as b,e as R}from"./index.b00245d2.js";import{S as p}from"./sys-code-gen-api.d5493310.js";import{K as C,r as U,a1 as z,k as A,ak as r,o as s,a as d,Y as t,S as o,b as E,W as y,F as _,ab as g,R as N}from"./vue.e20a9695.js";const $={class:"sys-codeGenFk-container"},K={class:"dialog-footer"},M=C({name:"sysCodeGenFk"}),q=C({...M,setup(P,{expose:k}){var u={};const F=U(),e=z({isShowDialog:!1,ruleForm:{},dbData:[],tableData:[],columnData:[]});A(async()=>{var n=await b(p).apiSysCodeGenDatabaseListGet();e.dbData=n.data.result});const v=async()=>{e.tableData=[],e.columnData=[],await I()},w=async()=>{e.columnData=[],await V()},I=async()=>{if(e.ruleForm.configId!=""){var n=await b(p).apiSysCodeGenTableListConfigIdGet(e.ruleForm.configId);e.tableData=n.data.result}},V=async()=>{if(!(e.ruleForm.configId==""||e.ruleForm.tableName=="")){console.log(e.ruleForm.configId,e.ruleForm.tableName);var n=await b(p).apiSysCodeGenColumnListByTableNameTableNameConfigIdGet(e.ruleForm.tableName,e.ruleForm.configId);e.columnData=n.data.result}},x=n=>{u=n,e.isShowDialog=!0},S=()=>{u.fkTableName=e.ruleForm.tableName;let n=e.tableData.filter(m=>m.tableName==e.ruleForm.tableName);u.fkEntityName=n.length==0?"":n[0].entityName,u.fkColumnName=e.ruleForm.columnName;let l=e.columnData.filter(m=>m.columnName==e.ruleForm.columnName);u.fkColumnNetType=l.length==0?"":l[0].netType,R.emit("submitRefreshFk",u),e.isShowDialog=!1},G=()=>{e.isShowDialog=!1},T=()=>{F.value.validate(async n=>{n&&S()})};return k({openDialog:x}),(n,l)=>{const m=r("el-option"),i=r("el-select"),c=r("el-form-item"),f=r("el-col"),h=r("el-row"),L=r("el-form"),D=r("el-button"),B=r("el-dialog");return s(),d("div",$,[t(B,{modelValue:e.isShowDialog,"onUpdate:modelValue":l[5]||(l[5]=a=>e.isShowDialog=a),title:"外键配置",draggable:"",width:"600px","destroy-on-close":""},{footer:o(()=>[E("span",K,[t(D,{onClick:G,size:"default"},{default:o(()=>[y("取 消")]),_:1}),t(D,{type:"primary",onClick:T,size:"default"},{default:o(()=>[y("确 定")]),_:1})])]),default:o(()=>[t(L,{model:e.ruleForm,ref_key:"ruleFormRef",ref:F,size:"default","label-width":"100px"},{default:o(()=>[t(h,{gutter:35},{default:o(()=>[t(f,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:o(()=>[t(c,{label:"库定位器",prop:"configId"},{default:o(()=>[t(i,{clearable:"",modelValue:e.ruleForm.configId,"onUpdate:modelValue":l[0]||(l[0]=a=>e.ruleForm.configId=a),placeholder:"库名",filterable:"",onChange:l[1]||(l[1]=a=>v())},{default:o(()=>[(s(!0),d(_,null,g(e.dbData,a=>(s(),N(m,{key:a.configId,label:a.configId,value:a.configId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(f,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:o(()=>[t(c,{label:"数据库表",prop:"tableName"},{default:o(()=>[t(i,{modelValue:e.ruleForm.tableName,"onUpdate:modelValue":l[2]||(l[2]=a=>e.ruleForm.tableName=a),class:"m-2",filterable:"",clearable:"",onChange:l[3]||(l[3]=a=>w())},{default:o(()=>[(s(!0),d(_,null,g(e.tableData,a=>(s(),N(m,{key:a.entityName,label:a.tableName,value:a.tableName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(f,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:o(()=>[t(c,{label:"显示字段",prop:"columnName"},{default:o(()=>[t(i,{modelValue:e.ruleForm.columnName,"onUpdate:modelValue":l[4]||(l[4]=a=>e.ruleForm.columnName=a)},{default:o(()=>[(s(!0),d(_,null,g(e.columnData,a=>(s(),N(m,{key:a.columnName,label:a.columnName,value:a.columnName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{q as _};
