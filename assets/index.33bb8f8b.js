import{f as _,e as p,E as w,z as E}from"./index.b8a2e51c.js";import{_ as W}from"./editTable.vue_vue_type_script_setup_true_name_sysEditTable_lang.592f1173.js";import{_ as Y}from"./editColumn.vue_vue_type_script_setup_true_name_sysEditColumn_lang.adc12ab1.js";import{_ as j}from"./addTable.vue_vue_type_script_setup_true_name_sysAddTable_lang.2b3f0810.js";import{_ as H}from"./addColumn.vue_vue_type_script_setup_true_name_sysAddColumn_lang.190b7054.js";import{_ as J}from"./genEntity.vue_vue_type_script_setup_true_name_sysGenEntity_lang.6d074876.js";import{S as g}from"./sys-database-api.e6c15cb8.js";import{K as $,r as y,a1 as O,k as X,a0 as Z,ak as c,au as ee,o as i,a as D,Y as a,S as t,T as S,R as d,F as B,ab as V,W as s}from"./vue.e20a9695.js";import"./monacoEditor.48edecf2.js";import"./database.e811a0f2.js";import"./sys-dict-data-api.c2e6ce44.js";const ae={class:"sys-database-container"},te=$({name:"sysDatabase"}),be=$({...te,setup(le){const C=y(),I=y(),k=y(),T=y(),R=y(),e=O({loading:!1,loading1:!1,dbData:[],configId:"",tableData:[],tableName:"",columnData:[],queryParams:{name:void 0,code:void 0},editPosTitle:""});X(async()=>{e.loading=!0;var l=await _(g).apiSysDatabaseListGet();e.dbData=l.data.result,e.loading=!1,p.on("submitRefreshTable",()=>{b()}),p.on("submitRefreshColumn",()=>{v()}),p.on("addTableSubmitted",o=>{b(),e.tableName=o,v()})}),Z(()=>{p.off("submitRefreshTable"),p.off("submitRefreshColumn"),p.off("addTableSubmitted")});const b=async()=>{e.tableName="",e.columnData=[],e.loading=!0;var l=await _(g).apiSysDatabaseTableListConfigIdGet(e.configId);e.tableData=l.data.result??[],e.loading=!1},v=async()=>{if(e.columnData=[],e.tableName!=""){e.loading1=!0;var l=await _(g).apiSysDatabaseColumnListTableNameConfigIdGet(e.tableName,e.configId);e.columnData=l.data.result??[],e.loading1=!1}},A=()=>{var m;if(!(e.configId==""||e.tableName=="")){var l=e.tableData.filter(N=>N.name==e.tableName),o={configId:e.configId,tableName:e.tableName,oldTableName:e.tableName,description:l[0].description};(m=C.value)==null||m.openDialog(o)}},G=()=>{var o;if(!(e.configId==""||e.tableName=="")){var l={configId:e.configId,tableName:e.tableName};(o=R.value)==null||o.openDialog(l)}},L=()=>{var o;if(e.configId==""){w({type:"error",message:"请选择库名!"});return}var l={configId:e.configId,tableName:"",oldTableName:"",description:""};(o=k.value)==null||o.openDialog(l)},q=l=>{var m;var o={configId:e.configId,tableName:l.tableName,columnName:l.dbColumnName,oldColumnName:l.dbColumnName,description:l.columnDescription};(m=I.value)==null||m.openDialog(o)},z=()=>{var o;if(e.configId==""||e.tableName==""){w({type:"error",message:"请选择库名和表名!"});return}const l={configId:e.configId,tableName:e.tableName,columnDescription:"",dataType:"",dbColumnName:"",decimalDigits:0,isIdentity:0,isNullable:0,isPrimarykey:0,length:0};(o=T.value)==null||o.openDialog(l)},F=()=>{E.confirm(`确定删除表：【${e.tableName}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const l={configId:e.configId,tableName:e.tableName};await _(g).apiSysDatabaseDeleteTablePost(l),b(),w.success("表删除成功")}).catch(()=>{})},M=l=>{E.confirm(`确定删除列：【${l.dbColumnName}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const o={configId:e.configId,tableName:e.tableName,dbColumnName:l.dbColumnName};await _(g).apiSysDatabaseDeleteColumnPost(o),b(),w.success("列删除成功")}).catch(()=>{})};return(l,o)=>{const m=c("el-option"),N=c("el-select"),h=c("el-form-item"),u=c("el-button"),U=c("el-form"),x=c("el-card"),r=c("el-table-column"),f=c("el-tag"),Q=c("el-table"),P=ee("loading");return i(),D("div",ae,[a(x,{shadow:"hover","body-style":{paddingBottom:"0"}},{default:t(()=>[S((i(),d(U,{model:e.queryParams,ref:"queryForm",inline:!0},{default:t(()=>[a(h,{label:"库名",prop:"configId"},{default:t(()=>[a(N,{modelValue:e.configId,"onUpdate:modelValue":o[0]||(o[0]=n=>e.configId=n),placeholder:"库名",filterable:"",onChange:b},{default:t(()=>[(i(!0),D(B,null,V(e.dbData,n=>(i(),d(m,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(h,{label:"表名",prop:"tableName"},{default:t(()=>[a(N,{modelValue:e.tableName,"onUpdate:modelValue":o[1]||(o[1]=n=>e.tableName=n),placeholder:"表名",filterable:"",clearable:"",onChange:v},{default:t(()=>[(i(!0),D(B,null,V(e.tableData,n=>(i(),d(m,{key:n.name,label:n.name+"["+n.description+"]",value:n.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(h,null,{default:t(()=>[a(u,{icon:"ele-Edit",type:"primary",onClick:A},{default:t(()=>[s(" 编辑表 ")]),_:1}),a(u,{icon:"ele-Delete",type:"danger",onClick:F},{default:t(()=>[s(" 删除表 ")]),_:1}),a(u,{icon:"ele-Plus",onClick:L},{default:t(()=>[s(" 增加表 ")]),_:1}),a(u,{icon:"ele-Plus",onClick:z},{default:t(()=>[s(" 增加列 ")]),_:1}),a(u,{icon:"ele-Plus",onClick:G},{default:t(()=>[s(" 生成实体 ")]),_:1})]),_:1})]),_:1},8,["model"])),[[P,e.loading]])]),_:1}),a(x,{shadow:"hover",style:{"margin-top":"8px"}},{default:t(()=>[S((i(),d(Q,{data:e.columnData,style:{width:"100%"},border:""},{default:t(()=>[a(r,{type:"index",label:"序号",width:"55",align:"center"}),a(r,{prop:"dbColumnName",label:"字段名","show-overflow-tooltip":""}),a(r,{prop:"dataType",label:"数据类型","show-overflow-tooltip":""}),a(r,{prop:"isPrimarykey",label:"主键",width:"70",align:"center","show-overflow-tooltip":""},{default:t(n=>[n.row.isPrimarykey===!0?(i(),d(f,{key:0,type:"success"},{default:t(()=>[s("是")]),_:1})):(i(),d(f,{key:1,type:"info"},{default:t(()=>[s("否")]),_:1}))]),_:1}),a(r,{prop:"isIdentity",label:"自增",width:"70",align:"center","show-overflow-tooltip":""},{default:t(n=>[n.row.isIdentity===!0?(i(),d(f,{key:0,type:"success"},{default:t(()=>[s("是")]),_:1})):(i(),d(f,{key:1,type:"info"},{default:t(()=>[s("否")]),_:1}))]),_:1}),a(r,{prop:"isNullable",label:"可空",width:"70",align:"center","show-overflow-tooltip":""},{default:t(n=>[n.row.isNullable===!0?(i(),d(f,{key:0},{default:t(()=>[s("是")]),_:1})):(i(),d(f,{key:1,type:"info"},{default:t(()=>[s("否")]),_:1}))]),_:1}),a(r,{prop:"length",label:"长度",width:"70",align:"center","show-overflow-tooltip":""}),a(r,{prop:"decimalDigits",label:"精度",width:"70",align:"center","show-overflow-tooltip":""}),a(r,{prop:"defaultValue",label:"默认值","show-overflow-tooltip":""}),a(r,{prop:"columnDescription",label:"描述","show-overflow-tooltip":""}),a(r,{label:"操作",width:"140",fixed:"right",align:"center","show-overflow-tooltip":""},{default:t(n=>[a(u,{icon:"ele-Edit",size:"small",text:"",type:"primary",onClick:K=>q(n.row)},{default:t(()=>[s(" 编辑 ")]),_:2},1032,["onClick"]),a(u,{icon:"ele-Delete",size:"small",text:"",type:"danger",onClick:K=>M(n.row)},{default:t(()=>[s(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[P,e.loading1]])]),_:1}),a(W,{ref_key:"editTableRef",ref:C},null,512),a(Y,{ref_key:"editColumnRef",ref:I},null,512),a(j,{ref_key:"addTableRef",ref:k},null,512),a(H,{ref_key:"addColumnRef",ref:T},null,512),a(J,{ref_key:"genEntityRef",ref:R},null,512)])}}});export{be as default};
