import{K as R,r as x,a1 as ae,k as oe,a0 as le,ak as r,au as D,o as u,a as re,Y as e,S as a,ac as T,T as g,R as p,W as d,X as q,u as P}from"./vue.e20a9695.js";import{f as ne}from"./formatTime.29ac8c52.js";import{a as z}from"./authFunction.e1e6e3d8.js";import{e as V,g as y,f as N,E as U}from"./index.122dcd40.js";import se from"./orgTree.311d4a3c.js";import{_ as ie}from"./editUser.vue_vue_type_script_setup_true_name_sysEditUser_lang.76dae746.js";import{S as de}from"./sys-org-api.93c7c288.js";import{S as v}from"./sys-user-api.3af6e387.js";import"./monacoEditor.48edecf2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./sys-pos-api.10c66e06.js";import"./sys-role-api.8f365c37.js";const ce={class:"sys-user-container"},ue=R({name:"sysUser"}),Se=R({...ue,setup(pe){const B=x(),b=x(),t=ae({loading:!1,userData:[],orgTreeData:[],queryParams:{orgId:-1,account:void 0,realName:void 0,phone:void 0},tableParams:{page:1,pageSize:10,total:0},editUserTitle:""});oe(async()=>{$(),i(),V.on("submitRefresh",()=>{i()})}),le(()=>{V.off("submitRefresh")});const $=async()=>{t.loading=!0;var o=await y(de).apiSysOrgListGet(0);t.orgTreeData=o.data.result??[],t.loading=!1},i=async()=>{var m,_;t.loading=!0;let o=Object.assign(t.queryParams,t.tableParams);var n=await y(v).apiSysUserPagePost(o);t.userData=((m=n.data.result)==null?void 0:m.items)??[],t.tableParams.total=(_=n.data.result)==null?void 0:_.total,t.loading=!1},E=()=>{t.queryParams.orgId=-1,t.queryParams.account=void 0,t.queryParams.realName=void 0,t.queryParams.phone=void 0,i()},K=()=>{var o;t.editUserTitle="添加账号",(o=b.value)==null||o.openDialog({})},O=o=>{var n;t.editUserTitle="编辑账号",(n=b.value)==null||n.openDialog(o)},Y=o=>{N.confirm(`确定删除账号：【${o.account}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await y(v).apiSysUserDeletePost({id:o.id}),i(),U.success("删除成功")}).catch(()=>{})},A=o=>{t.tableParams.pageSize=o,i()},I=o=>{t.tableParams.page=o,i()},M=o=>{y(v).apiSysUserSetStatusPost({id:o.id,status:o.status}).then(()=>{U.success("账号状态设置成功")}).catch(()=>{o.status=o.status==1?2:1})},j=async o=>{N.confirm(`确定重置密码：【${o.account}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await y(v).apiSysUserResetPwdPost({id:o.id}),U.success("密码重置成功：123456")}).catch(()=>{})},F=async o=>{t.queryParams.orgId=o.id,t.queryParams.account=void 0,t.queryParams.realName=void 0,t.queryParams.phone=void 0,i()};return(o,n)=>{const m=r("el-col"),_=r("el-input"),w=r("el-form-item"),f=r("el-button"),L=r("el-button-group"),Q=r("el-form"),k=r("el-card"),s=r("el-table-column"),G=r("el-avatar"),S=r("el-tag"),W=r("el-switch"),C=r("el-dropdown-item"),X=r("el-dropdown-menu"),H=r("el-dropdown"),J=r("el-table"),Z=r("el-pagination"),ee=r("el-row"),h=D("auth"),te=D("loading");return u(),re("div",ce,[e(ee,{gutter:8,style:{width:"100%"}},{default:a(()=>[e(m,{span:4,xs:24},{default:a(()=>[e(se,{ref_key:"orgTreeRef",ref:B,onNodeClick:F},null,512)]),_:1}),e(m,{span:20,xs:24},{default:a(()=>[e(k,{shadow:"hover","body-style":{paddingBottom:"0"}},{default:a(()=>[e(Q,{model:t.queryParams,ref:"queryForm",inline:!0},{default:a(()=>[e(w,{label:"账号",prop:"account"},{default:a(()=>[e(_,{placeholder:"账号",clearable:"",onKeyup:T(i,["enter"]),modelValue:t.queryParams.account,"onUpdate:modelValue":n[0]||(n[0]=l=>t.queryParams.account=l)},null,8,["onKeyup","modelValue"])]),_:1}),e(w,{label:"手机号码",prop:"phone"},{default:a(()=>[e(_,{placeholder:"手机号码",clearable:"",onKeyup:T(i,["enter"]),modelValue:t.queryParams.phone,"onUpdate:modelValue":n[1]||(n[1]=l=>t.queryParams.phone=l)},null,8,["onKeyup","modelValue"])]),_:1}),e(w,null,{default:a(()=>[e(L,null,{default:a(()=>[g((u(),p(f,{type:"primary",icon:"ele-Search",onClick:i},{default:a(()=>[d(" 查询 ")]),_:1})),[[h,"sysUser:page"]]),e(f,{icon:"ele-Refresh",onClick:E},{default:a(()=>[d(" 重置 ")]),_:1})]),_:1})]),_:1}),e(w,null,{default:a(()=>[g((u(),p(f,{type:"primary",icon:"ele-Plus",onClick:K},{default:a(()=>[d(" 新增 ")]),_:1})),[[h,"sysUser:add"]])]),_:1})]),_:1},8,["model"])]),_:1}),e(k,{shadow:"hover",style:{"margin-top":"8px"}},{default:a(()=>[g((u(),p(J,{data:t.userData,style:{width:"100%"},border:""},{default:a(()=>[e(s,{type:"index",label:"序号",width:"55",align:"center",fixed:""}),e(s,{prop:"account",label:"账号",width:"120",fixed:"","show-overflow-tooltip":""}),e(s,{prop:"nickName",label:"昵称",width:"120","show-overflow-tooltip":""}),e(s,{label:"头像",width:"80",align:"center","show-overflow-tooltip":""},{default:a(l=>[e(G,{src:"",size:"small"},{default:a(()=>{var c;return[d(q((c=l.row.nickName)==null?void 0:c.slice(0,1)),1)]}),_:2},1024)]),_:1}),e(s,{prop:"realName",label:"姓名",width:"120","show-overflow-tooltip":""}),e(s,{label:"出生日期",width:"100",align:"center","show-overflow-tooltip":""},{default:a(l=>[d(q(P(ne)(new Date(l.row.birthday),"YYYY-mm-dd")),1)]),_:1}),e(s,{label:"性别",width:"70",align:"center","show-overflow-tooltip":""},{default:a(l=>[l.row.sex===1?(u(),p(S,{key:0,type:"success"},{default:a(()=>[d(" 男 ")]),_:1})):(u(),p(S,{key:1,type:"danger"},{default:a(()=>[d(" 女 ")]),_:1}))]),_:1}),e(s,{prop:"phone",label:"手机号码",width:"120",align:"center","show-overflow-tooltip":""}),e(s,{label:"状态",width:"70",align:"center","show-overflow-tooltip":""},{default:a(l=>[g(e(W,{modelValue:l.row.status,"onUpdate:modelValue":c=>l.row.status=c,"active-value":1,"inactive-value":2,size:"small",onChange:c=>M(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[h,"sysUser:setStatus"]])]),_:1}),e(s,{prop:"orderNo",label:"排序",width:"70",align:"center","show-overflow-tooltip":""}),e(s,{prop:"createTime",label:"修改时间",width:"160","show-overflow-tooltip":""}),e(s,{prop:"remark",label:"备注","show-overflow-tooltip":""}),e(s,{label:"操作",width:"110",align:"center",fixed:"right","show-overflow-tooltip":""},{default:a(l=>[g((u(),p(f,{icon:"ele-Edit",size:"small",text:"",type:"primary",onClick:c=>O(l.row)},{default:a(()=>[d(" 编辑 ")]),_:2},1032,["onClick"])),[[h,"sysUser:update"]]),e(H,null,{dropdown:a(()=>[e(X,null,{default:a(()=>[e(C,{icon:"ele-RefreshLeft",onClick:c=>j(l.row),disabled:!P(z)("sysUser:resetPwd")},{default:a(()=>[d(" 重置密码 ")]),_:2},1032,["onClick","disabled"]),e(C,{icon:"ele-Delete",onClick:c=>Y(l.row),divided:"",disabled:!P(z)("sysUser:delete")},{default:a(()=>[d(" 删除账号 ")]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),default:a(()=>[e(f,{icon:"ele-MoreFilled",size:"small",text:"",type:"primary",style:{"padding-left":"12px"}})]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[te,t.loading]]),e(Z,{currentPage:t.tableParams.page,"onUpdate:currentPage":n[2]||(n[2]=l=>t.tableParams.page=l),"page-size":t.tableParams.pageSize,"onUpdate:pageSize":n[3]||(n[3]=l=>t.tableParams.pageSize=l),total:t.tableParams.total,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:A,onCurrentChange:I,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])]),_:1})]),_:1})]),_:1}),e(ie,{ref_key:"editUserRef",ref:b,title:t.editUserTitle,orgData:t.orgTreeData},null,8,["title","orgData"])])}}});export{Se as default};
