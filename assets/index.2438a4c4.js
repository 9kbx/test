import{K as N,aG as se,r as x,a1 as pe,k as de,a0 as ue,ak as m,au as z,o as n,a as ce,Y as e,S as t,ac as V,T as k,R as s,W as i,V as b,b as R,u as fe,X as be}from"./vue.e20a9695.js";import{e as O,f as g,G as me,z as $,E as _}from"./index.96b44ad7.js";import{_ as ge}from"./editJobDetail.vue_vue_type_script_setup_true_name_sysEditJobDetail_lang.388888dd.js";import{_ as ye}from"./editJobTrigger.vue_vue_type_script_setup_true_name_sysEditJobTrigger_lang.a60f99ca.js";import{_ as we}from"./jobCluster.vue_vue_type_script_setup_true_lang.e4eb61b0.js";import{S as y}from"./sys-job-api.2554cdf0.js";import"./monacoEditor.9170b963.js";import"./index.db638cf0.js";import"./second.3c756285.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./min.d2ea93a8.js";import"./hour.d395e55d.js";import"./day.e207475a.js";import"./month.26daa728.js";import"./week.167db312.js";import"./year.07a7316e.js";import"./result.vue_vue_type_script_setup_true_lang.36186e62.js";const _e={class:"sys-job-container"},he={style:{display:"flex","align-items":"center"}},ve={style:{"margin-left":"5px"}},ke=N({name:"sysJob"}),Ee=N({...ke,setup(Je){const A=se(),j=x(),D=x(),T=x(),r=pe({loading:!1,jobData:[],queryParams:{jobId:void 0,description:void 0},tableParams:{page:1,pageSize:10,total:0},editJobDetailTitle:"",editJobTriggerTitle:""});de(async()=>{w(),O.on("submitRefresh",()=>{w()})}),ue(()=>{O.off("submitRefresh")});const w=async()=>{var v,h;r.loading=!0;let o=Object.assign(r.queryParams,r.tableParams);var u=await g(y).apiSysJobPageJobDetailPost(o);r.jobData=((v=u.data.result)==null?void 0:v.items)??[],r.tableParams.total=(h=u.data.result)==null?void 0:h.total,r.loading=!1},q=()=>{r.queryParams.jobId=void 0,r.queryParams.description=void 0,w()},B=()=>{var o;r.editJobDetailTitle="添加作业",(o=j.value)==null||o.openDialog({concurrent:!0,includeAnnotations:!0,groupName:"default",createFromScript:!0})},E=o=>{var u;r.editJobDetailTitle="编辑作业",(u=j.value)==null||u.openDialog(o.jobDetail)},K=o=>{$.confirm(`确定删除作业：【${o.jobDetail.jobId}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await g(y).apiSysJobDeleteJobDetailPost({jobId:o.jobDetail.jobId}),w(),_.success("删除成功")}).catch(()=>{})},F=o=>{var u;r.editJobTriggerTitle="添加触发器",(u=D.value)==null||u.openDialog({jobId:o.jobDetail.jobId,retryTimeout:1e3,startNow:!0,runOnStart:!0,resetOnlyOnce:!0,triggerType:"Furion.Schedule.PeriodTrigger"})},U=o=>{var u;r.editJobTriggerTitle="编辑触发器",(u=D.value)==null||u.openDialog(o)},G=o=>{$.confirm(`确定删除触发器：【${o.triggerId}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await g(y).apiSysJobDeleteJobTriggerPost({jobId:o.jobId,triggerId:o.triggerId}),w(),_.success("删除成功")}).catch(()=>{})},M=o=>{r.tableParams.pageSize=o,w()},Q=o=>{r.tableParams.page=o,w()},W=async()=>{await g(y).apiSysJobStartAllJobPost(),_.success("启动所有作业")},X=async()=>{await g(y).apiSysJobPauseAllJobPost(),_.success("暂停所有作业")},Y=async o=>{await g(y).apiSysJobStartJobPost({jobId:o.jobDetail.jobId}),_.success("启动作业")},H=async o=>{await g(y).apiSysJobPauseJobPost({jobId:o.jobDetail.jobId}),_.success("暂停作业")},L=async o=>{await g(y).apiSysJobStartTriggerPost({jobId:o.jobId,triggerId:o.triggerId}),_.success("启动触发器")},Z=async o=>{await g(y).apiSysJobPauseTriggerPost({jobId:o.jobId,triggerId:o.triggerId}),_.success("暂停触发器")},ee=async()=>{await g(y).apiSysJobCancelSleepPost(),_.success("强制唤醒作业调度器")},te=async()=>{await g(y).apiSysJobPersistAllPost(),_.success("强制触发所有作业持久化")},oe=()=>{var o;(o=T.value)==null||o.openDrawer()},le=()=>{A.push({path:"/platform/job/dashboard"})};return(o,u)=>{const v=m("el-input"),h=m("el-form-item"),c=m("el-button"),P=m("el-button-group"),f=m("el-tooltip"),ae=m("el-form"),S=m("el-card"),l=m("el-table-column"),p=m("el-tag"),I=m("el-table"),re=m("el-icon"),ie=m("el-pagination"),J=z("auth"),ne=z("loading");return n(),ce("div",_e,[e(S,{shadow:"hover","body-style":{paddingBottom:"0"}},{default:t(()=>[e(ae,{model:r.queryParams,ref:"queryForm",inline:!0},{default:t(()=>[e(h,{label:"作业编号",prop:"jobId"},{default:t(()=>[e(v,{placeholder:"作业编号",clearable:"",onKeyup:V(w,["enter"]),modelValue:r.queryParams.jobId,"onUpdate:modelValue":u[0]||(u[0]=d=>r.queryParams.jobId=d)},null,8,["onKeyup","modelValue"])]),_:1}),e(h,{label:"描述信息",prop:"description"},{default:t(()=>[e(v,{placeholder:"描述信息",clearable:"",onKeyup:V(w,["enter"]),modelValue:r.queryParams.description,"onUpdate:modelValue":u[1]||(u[1]=d=>r.queryParams.description=d)},null,8,["onKeyup","modelValue"])]),_:1}),e(h,null,{default:t(()=>[e(P,null,{default:t(()=>[k((n(),s(c,{type:"primary",icon:"ele-Search",onClick:w},{default:t(()=>[i(" 查询 ")]),_:1})),[[J,"sysJob:pageJobDetail"]]),e(c,{icon:"ele-Refresh",onClick:q},{default:t(()=>[i(" 重置 ")]),_:1})]),_:1})]),_:1}),e(h,null,{default:t(()=>[e(P,{style:{margin:"0px 12px"}},{default:t(()=>[e(f,{content:"增加作业"},{default:t(()=>[k(e(c,{icon:"ele-CirclePlus",onClick:B},null,512),[[J,"sysJob:addJobDetail"]])]),_:1}),e(f,{content:"启动所有作业"},{default:t(()=>[e(c,{icon:"ele-VideoPlay",onClick:W})]),_:1}),e(f,{content:"暂停所有作业"},{default:t(()=>[e(c,{icon:"ele-VideoPause",onClick:X})]),_:1})]),_:1}),e(P,{style:{margin:"0px 12px 0px 0px"}},{default:t(()=>[e(f,{content:"强制唤醒作业调度器"},{default:t(()=>[e(c,{icon:"ele-AlarmClock",onClick:ee})]),_:1}),e(f,{content:"强制触发所有作业持久化"},{default:t(()=>[e(c,{icon:"ele-Connection",onClick:te})]),_:1})]),_:1}),e(c,{icon:"ele-Coin",onClick:oe,plain:""},{default:t(()=>[i(" 集群控制 ")]),_:1}),e(c,{icon:"ele-Grid",onClick:le,plain:""},{default:t(()=>[i(" 任务看板 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(S,{shadow:"hover",style:{"margin-top":"8px"}},{default:t(()=>[k((n(),s(I,{data:r.jobData,style:{width:"100%"},border:""},{default:t(()=>[e(l,{type:"expand",fixed:""},{default:t(d=>[e(I,{style:{"margin-left":"48px",width:"calc(100% - 48px)"},data:d.row.jobTriggers,border:"",size:"small"},{default:t(()=>[e(l,{type:"index",label:"序号",width:"55",align:"center",fixed:""}),e(l,{prop:"triggerId",label:"触发器编号",width:"120",fixed:"","show-overflow-tooltip":""}),e(l,{prop:"triggerType",label:"类型","show-overflow-tooltip":""}),e(l,{prop:"assemblyName",label:"程序集","show-overflow-tooltip":""}),e(l,{prop:"args",label:"参数","show-overflow-tooltip":""}),e(l,{prop:"description",label:"描述",width:"120","show-overflow-tooltip":""}),e(l,{prop:"status",label:"状态",width:"100",align:"center","show-overflow-tooltip":""},{default:t(a=>[a.row.status==0?(n(),s(p,{key:0,type:"warning",effect:"plain"},{default:t(()=>[i(" 积压 ")]),_:1})):b("",!0),a.row.status==1?(n(),s(p,{key:1,type:"",effect:"plain"},{default:t(()=>[i(" 就绪 ")]),_:1})):b("",!0),a.row.status==2?(n(),s(p,{key:2,type:"success",effect:"plain"},{default:t(()=>[i(" 正在运行 ")]),_:1})):b("",!0),a.row.status==3?(n(),s(p,{key:3,type:"danger",effect:"plain"},{default:t(()=>[i(" 暂停 ")]),_:1})):b("",!0),a.row.status==4?(n(),s(p,{key:4,type:"danger",effect:"plain"},{default:t(()=>[i(" 阻塞 ")]),_:1})):b("",!0),a.row.status==5?(n(),s(p,{key:5,type:"",effect:"plain"},{default:t(()=>[i(" 由失败进入就绪 ")]),_:1})):b("",!0),a.row.status==6?(n(),s(p,{key:6,type:"danger",effect:"plain"},{default:t(()=>[i(" 归档 ")]),_:1})):b("",!0),a.row.status==7?(n(),s(p,{key:7,type:"danger",effect:"plain"},{default:t(()=>[i(" 崩溃 ")]),_:1})):b("",!0),a.row.status==8?(n(),s(p,{key:8,type:"danger",effect:"plain"},{default:t(()=>[i(" 超限 ")]),_:1})):b("",!0),a.row.status==9?(n(),s(p,{key:9,type:"danger",effect:"plain"},{default:t(()=>[i(" 无触发时间 ")]),_:1})):b("",!0),a.row.status==10?(n(),s(p,{key:10,type:"danger",effect:"plain"},{default:t(()=>[i(" 未启动 ")]),_:1})):b("",!0),a.row.status==11?(n(),s(p,{key:11,type:"danger",effect:"plain"},{default:t(()=>[i(" 未知作业触发器 ")]),_:1})):b("",!0),a.row.status==12?(n(),s(p,{key:12,type:"danger",effect:"plain"},{default:t(()=>[i(" 未知作业处理程序 ")]),_:1})):b("",!0)]),_:2},1024),e(l,{prop:"startTime",label:"起始时间",width:"100",align:"center","show-overflow-tooltip":""}),e(l,{prop:"endTime",label:"结束时间",width:"100",align:"center","show-overflow-tooltip":""}),e(l,{prop:"lastRunTime",label:"最近运行时间",width:"140",align:"center","show-overflow-tooltip":""}),e(l,{prop:"nextRunTime",label:"下一次运行时间",width:"140",align:"center","show-overflow-tooltip":""}),e(l,{prop:"numberOfRuns",label:"触发次数",width:"100",align:"center","show-overflow-tooltip":""}),e(l,{prop:"maxNumberOfRuns",label:"最大触发次数",width:"120",align:"center","show-overflow-tooltip":""}),e(l,{prop:"numberOfErrors",label:"出错次数",width:"100",align:"center","show-overflow-tooltip":""}),e(l,{prop:"maxNumberOfErrors",label:"最大出错次数",width:"120",align:"center","show-overflow-tooltip":""}),e(l,{prop:"numRetries",label:"重试次数",width:"100",align:"center","show-overflow-tooltip":""}),e(l,{prop:"retryTimeout",label:"重试间隔ms",width:"100",align:"center","show-overflow-tooltip":""}),e(l,{prop:"startNow",label:"是否立即启动",width:"100",align:"center","show-overflow-tooltip":""},{default:t(a=>[a.row.startNow==!0?(n(),s(p,{key:0},{default:t(()=>[i(" 是 ")]),_:1})):(n(),s(p,{key:1,type:"info"},{default:t(()=>[i(" 否 ")]),_:1}))]),_:2},1024),e(l,{prop:"runOnStart",label:"是否启动时执行一次",width:"150",align:"center","show-overflow-tooltip":""},{default:t(a=>[a.row.runOnStart==!0?(n(),s(p,{key:0},{default:t(()=>[i(" 是 ")]),_:1})):(n(),s(p,{key:1,type:"info"},{default:t(()=>[i(" 否 ")]),_:1}))]),_:2},1024),e(l,{prop:"resetOnlyOnce",label:"是否重置触发次数",width:"120",align:"center","show-overflow-tooltip":""},{default:t(a=>[a.row.resetOnlyOnce==!0?(n(),s(p,{key:0},{default:t(()=>[i(" 是 ")]),_:1})):(n(),s(p,{key:1,type:"info"},{default:t(()=>[i(" 否 ")]),_:1}))]),_:2},1024),e(l,{prop:"updatedTime",label:"更新时间",width:"140",align:"center","show-overflow-tooltip":""}),e(l,{label:"操作",width:"140",align:"center","show-overflow-tooltip":"",fixed:"right"},{default:t(a=>[e(f,{content:"启动触发器"},{default:t(()=>[e(c,{size:"small",type:"primary",icon:"ele-VideoPlay",text:"",onClick:C=>L(a.row)},null,8,["onClick"])]),_:2},1024),e(f,{content:"暂停触发器"},{default:t(()=>[e(c,{size:"small",type:"primary",icon:"ele-VideoPause",text:"",onClick:C=>Z(a.row)},null,8,["onClick"])]),_:2},1024),e(f,{content:"编辑触发器"},{default:t(()=>[e(c,{size:"small",type:"primary",icon:"ele-Edit",text:"",onClick:C=>U(a.row)},null,8,["onClick"])]),_:2},1024),e(f,{content:"删除触发器"},{default:t(()=>[e(c,{size:"small",type:"danger",icon:"ele-Delete",text:"",onClick:C=>G(a.row)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["data"])]),_:1}),e(l,{type:"index",label:"序号",width:"55",align:"center",fixed:""}),e(l,{prop:"jobDetail.jobId",label:"作业编号",width:"150",fixed:""},{default:t(d=>[R("div",he,[e(re,null,{default:t(()=>[e(fe(me))]),_:1}),R("span",ve,be(d.row.jobDetail.jobId),1)])]),_:1}),e(l,{prop:"jobDetail.groupName",label:"组名称","show-overflow-tooltip":""}),e(l,{prop:"jobDetail.jobType",label:"类型","show-overflow-tooltip":""}),e(l,{prop:"jobDetail.assemblyName",label:"程序集","show-overflow-tooltip":""}),e(l,{prop:"jobDetail.description",label:"描述","show-overflow-tooltip":""}),e(l,{prop:"jobDetail.concurrent",label:"执行方式",width:"100",align:"center","show-overflow-tooltip":""},{default:t(d=>[d.row.jobDetail.concurrent==!0?(n(),s(p,{key:0,type:"success"},{default:t(()=>[i(" 并行 ")]),_:1})):(n(),s(p,{key:1,type:"warning"},{default:t(()=>[i(" 串行 ")]),_:1}))]),_:1}),e(l,{prop:"jobDetail.createFromScript",label:"脚本创建",width:"100",align:"center","show-overflow-tooltip":""},{default:t(d=>[d.row.jobDetail.createFromScript==!0?(n(),s(p,{key:0},{default:t(()=>[i(" 是 ")]),_:1})):(n(),s(p,{key:1,type:"info"},{default:t(()=>[i(" 否 ")]),_:1}))]),_:1}),e(l,{prop:"jobDetail.properties",label:"额外数据","show-overflow-tooltip":""}),e(l,{prop:"jobDetail.updatedTime",label:"更新时间",width:"160",align:"center","show-overflow-tooltip":""}),e(l,{label:"操作",width:"170",fixed:"right",align:"center","show-overflow-tooltip":""},{default:t(d=>[e(f,{content:"增加触发器"},{default:t(()=>[e(c,{size:"small",type:"primary",icon:"ele-CirclePlus",text:"",onClick:a=>F(d.row)},null,8,["onClick"])]),_:2},1024),e(f,{content:"启动作业"},{default:t(()=>[e(c,{size:"small",type:"primary",icon:"ele-VideoPlay",text:"",onClick:a=>Y(d.row)},null,8,["onClick"])]),_:2},1024),e(f,{content:"暂停作业"},{default:t(()=>[e(c,{size:"small",type:"primary",icon:"ele-VideoPause",text:"",onClick:a=>H(d.row)},null,8,["onClick"])]),_:2},1024),e(f,{content:"编辑作业"},{default:t(()=>[k(e(c,{size:"small",type:"primary",icon:"ele-Edit",text:"",onClick:a=>E(d.row)},null,8,["onClick"]),[[J,"sysJob:updateJobDetail"]])]),_:2},1024),e(f,{content:"删除作业"},{default:t(()=>[k(e(c,{size:"small",type:"danger",icon:"ele-Delete",text:"",onClick:a=>K(d.row)},null,8,["onClick"]),[[J,"sysJob:deleteJobDetail"]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ne,r.loading]]),e(ie,{currentPage:r.tableParams.page,"onUpdate:currentPage":u[2]||(u[2]=d=>r.tableParams.page=d),"page-size":r.tableParams.pageSize,"onUpdate:pageSize":u[3]||(u[3]=d=>r.tableParams.pageSize=d),total:r.tableParams.total,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:M,onCurrentChange:Q,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])]),_:1}),e(ge,{ref_key:"editJobDetailRef",ref:j,title:r.editJobDetailTitle},null,8,["title"]),e(ye,{ref_key:"editJobTriggerRef",ref:D,title:r.editJobTriggerTitle},null,8,["title"]),e(we,{ref_key:"editJobClusterRef",ref:T},null,512)])}}});export{Ee as default};
