import{K as j,a1 as I,k as $,ak as m,au as w,o as S,a as E,Y as n,S as p,ac as H,W as U,T as x,R as v}from"./vue.e20a9695.js";import{B as K,i as V,j as C,f as N,H as Q,I as D,z as J,x as M,J as W}from"./index.795da706.js";import{c as P}from"./signalR.ddd4a965.js";import"./monacoEditor.9170b963.js";const A=function(u){return{apiSysOnlineUserForceOfflinePost:async(t,e={})=>{const i="/api/sysOnlineUser/forceOffline",o=new URL(i,"https://example.com");let a;u&&(a=u.baseOptions);const c={method:"POST",...a,...e},h={},g={};h["Content-Type"]="application/json-patch+json";const d=new URLSearchParams(o.search);for(const l in g)d.set(l,g[l]);for(const l in e.params)d.set(l,e.params[l]);o.search=new URLSearchParams(d).toString();let s=a&&a.headers?a.headers:{};c.headers={...h,...s,...e.headers};const r=typeof t!="string"||c.headers["Content-Type"]==="application/json";return c.data=r?JSON.stringify(t!==void 0?t:{}):t||"",{url:o.pathname+o.search+o.hash,options:c}},apiSysOnlineUserPagePost:async(t,e={})=>{const i="/api/sysOnlineUser/page",o=new URL(i,"https://example.com");let a;u&&(a=u.baseOptions);const c={method:"POST",...a,...e},h={},g={};h["Content-Type"]="application/json-patch+json";const d=new URLSearchParams(o.search);for(const l in g)d.set(l,g[l]);for(const l in e.params)d.set(l,e.params[l]);o.search=new URLSearchParams(d).toString();let s=a&&a.headers?a.headers:{};c.headers={...h,...s,...e.headers};const r=typeof t!="string"||c.headers["Content-Type"]==="application/json";return c.data=r?JSON.stringify(t!==void 0?t:{}):t||"",{url:o.pathname+o.search+o.hash,options:c}}}},q=function(u){return{async apiSysOnlineUserForceOfflinePost(t,e){const i=await A(u).apiSysOnlineUserForceOfflinePost(t,e);return(o=V,a=C)=>{const c={...i.options,url:a+i.url};return o.request(c)}},async apiSysOnlineUserPagePost(t,e){const i=await A(u).apiSysOnlineUserPagePost(t,e);return(o=V,a=C)=>{const c={...i.options,url:a+i.url};return o.request(c)}}}};class Y extends K{async apiSysOnlineUserForceOfflinePost(t,e){return q(this.configuration).apiSysOnlineUserForceOfflinePost(t,e).then(i=>i(this.axios,this.basePath))}async apiSysOnlineUserPagePost(t,e){return q(this.configuration).apiSysOnlineUserPagePost(t,e).then(i=>i(this.axios,this.basePath))}}const G={class:"sys-onlineUser-container"},se=j({__name:"index",setup(u,{expose:t}){const e=I({loading:!1,isVisible:!1,queryParams:{userName:void 0,realName:void 0},tableParams:{page:1,pageSize:10,total:0},onlineUserList:[],lastUserState:{online:!1,realName:""}});$(async()=>{P.off("OnlineUserList"),P.on("OnlineUserList",s=>{e.onlineUserList=s.userList,e.lastUserState={online:s.online,realName:s.realName},i()}),P.off("ForceOffline"),P.on("ForceOffline",async s=>{console.log("强制下线",s),await P.stop(),await N(M).apiSysAuthLogoutPost(),Q()})});const i=D(function(){W({title:"提示",message:`${e.lastUserState.online?`【${e.lastUserState.realName}】上线了`:`【${e.lastUserState.realName}】离开了`}`,type:`${e.lastUserState.online?"info":"error"}`,position:"bottom-right"})},3e3,{leading:!0,trailing:!1}),o=()=>{e.isVisible=!0},a=async()=>{var l,_;e.loading=!0;let s=Object.assign(e.queryParams,e.tableParams);var r=await N(Y).apiSysOnlineUserPagePost(s);e.onlineUserList=((l=r.data.result)==null?void 0:l.items)??[],e.tableParams.total=(_=r.data.result)==null?void 0:_.total,e.loading=!1},c=()=>{e.queryParams.userName=void 0,e.queryParams.realName=void 0,a()},h=async s=>{J.confirm(`确定踢掉账号：【${s.realName}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await P.send("ForceOffline",{connectionId:s.connectionId}).catch(function(r){console.log(r)})}).catch(()=>{})},g=s=>{e.tableParams.pageSize=s,a()},d=s=>{e.tableParams.page=s,a()};return t({openDrawer:o}),(s,r)=>{const l=m("el-input"),_=m("el-form-item"),O=m("el-button"),z=m("el-button-group"),k=m("el-form"),b=m("el-card"),y=m("el-table-column"),L=m("el-table"),T=m("el-pagination"),B=m("el-drawer"),F=w("auth"),R=w("loading");return S(),E("div",G,[n(B,{modelValue:e.isVisible,"onUpdate:modelValue":r[3]||(r[3]=f=>e.isVisible=f),title:"在线用户列表",size:"40%"},{default:p(()=>[n(b,{shadow:"hover","body-style":{paddingBottom:"0"},style:{margin:"8px"}},{default:p(()=>[n(k,{model:e.queryParams,ref:"queryForm",inline:!0},{default:p(()=>[n(_,{label:"账号名称",prop:"userName"},{default:p(()=>[n(l,{placeholder:"账号名称",clearable:"",onKeyup:H(a,["enter"]),modelValue:e.queryParams.userName,"onUpdate:modelValue":r[0]||(r[0]=f=>e.queryParams.userName=f)},null,8,["onKeyup","modelValue"])]),_:1}),n(_,null,{default:p(()=>[n(z,null,{default:p(()=>[n(O,{type:"primary",icon:"ele-Search",onClick:a},{default:p(()=>[U(" 查询 ")]),_:1}),n(O,{icon:"ele-Refresh",onClick:c},{default:p(()=>[U(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),n(b,{shadow:"hover",style:{margin:"8px","padding-bottom":"15px"}},{default:p(()=>[x((S(),v(L,{data:e.onlineUserList,style:{width:"100%"},border:""},{default:p(()=>[n(y,{type:"index",label:"序号",width:"55",align:"center"}),n(y,{prop:"userName",label:"账号","show-overflow-tooltip":""}),n(y,{prop:"realName",label:"姓名","show-overflow-tooltip":""}),n(y,{prop:"ip",label:"IP地址","show-overflow-tooltip":""}),n(y,{prop:"browser",label:"浏览器","show-overflow-tooltip":""}),n(y,{prop:"time",label:"登录时间","show-overflow-tooltip":""}),n(y,{label:"操作",width:"81",fixed:"right",align:"center","show-overflow-tooltip":""},{default:p(f=>[x((S(),v(O,{icon:"ele-CircleClose",size:"small",text:"",type:"danger",onClick:X=>h(f.row)},{default:p(()=>[U(" 下线 ")]),_:2},1032,["onClick"])),[[F,"sysOnlineUser:forceOffline"]])]),_:1})]),_:1},8,["data"])),[[R,e.loading]]),n(T,{currentPage:e.tableParams.page,"onUpdate:currentPage":r[1]||(r[1]=f=>e.tableParams.page=f),"page-size":e.tableParams.pageSize,"onUpdate:pageSize":r[2]||(r[2]=f=>e.tableParams.pageSize=f),total:e.tableParams.total,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:g,onCurrentChange:d,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])]),_:1})]),_:1},8,["modelValue"])])}}});export{se as default};
