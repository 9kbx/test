import{K as G,az as ye,r as b,a1 as be,k as Fe,a0 as Ve,w as xe,ak as t,au as Y,o as F,a as he,Y as e,S as a,b as n,T as V,u as v,X as k,W as i,R as S,aE as Se,aF as Be}from"./vue.e20a9695.js";import{l as Pe,g as w,e as q,P as W,f as H,H as Ue,Q as ke}from"./index.a169e15e.js";import Ce from"./orgTree.fefab9d0.js";import Ne from"./index.09b8d42b.js";import{S as C}from"./sys-file-api.696a2726.js";import{S as R}from"./sys-user-api.ed7c05fd.js";import{_ as De}from"./_plugin-vue_export-helper.c27b6911.js";import"./monacoEditor.48edecf2.js";import"./sys-org-api.85b877c8.js";function Ie(y,N,D=null){var d=y.split(","),x=d[0].match(/:(.*?);/)[1],B=atob(d[1]);let m=B.length;for(var h=new Uint8Array(m);m--;)h[m]=B.charCodeAt(m);return new File([h],N,{type:D||x})}const Re=y=>(Se("data-v-04d495dd"),y=y(),Be(),y),Te={class:"sys-userCenter-container"},Oe={class:"account-center-avatarHolder"},Ae={class:"username"},Ee={class:"account-center-org"},Me={class:"image-signature"},ze={style:{color:"#fff"}},Le=Re(()=>n("span",null," 电子签名 ",-1)),Ye={style:{border:"1px dashed gray",width:"100%",height:"250px"}},qe={style:{"margin-top":"10px"}},We={style:{display:"inline"}},He={style:{display:"inline","margin-left":"30px"}},Ge={class:"dialog-footer"},Ke=G({name:"sysUserCenter"}),Qe=G({...Ke,setup(y,{expose:N}){const D=Pe(),{userInfos:d}=ye(D),x=b(),B=b(),m=b(),h=b(),T=b(),O=b(),l=be({loading:!1,avatarLoading:!1,signDialogVisible:!1,ruleFormBase:{},ruleFormPassword:{},signOptions:{penColor:"#000000",minWidth:1,onBegin:()=>{m.value.resizeCanvas()}},signFileList:[],passwordNew2:"",cropperTitle:""});Fe(async()=>{l.loading=!0;var r=await w(R).apiSysUserBaseInfoGet();l.ruleFormBase=r.data.result??{account:""},l.loading=!1,q.on("uploadCropperImg",async o=>{var _;var u=await w(C).apiSysFileUploadAvatarPostForm(o.img);d.value.avatar=((_=u.data.result)==null?void 0:_.url)+""})}),Ve(()=>{q.off("uploadCropperImg",()=>{})}),xe(l.signOptions,()=>{m.value.signaturePad.penColor=l.signOptions.penColor,m.value.signaturePad.minWidth=l.signOptions.minWidth});const K=()=>{l.signDialogVisible=!0},Q=async()=>{var _;const{isEmpty:r,data:o}=m.value.saveSignature();if(!r){var u=await w(C).apiSysFileUploadSignaturePostForm(Ie(o,d.value.account+".png"));d.value.signature=((_=u.data.result)==null?void 0:_.url)+"",A(),l.signDialogVisible=!1}},X=()=>{m.value.undoSignature()},A=()=>{m.value.clearSignature()},j=async r=>{var u;var o=await w(C).apiSysFileUploadSignaturePostForm(r.raw);d.value.signature=((u=o.data.result)==null?void 0:u.url)+""},J=(r,o)=>{l.signFileList=o},Z=async r=>{var u,_;var o=await w(C).apiSysFileUploadAvatarPostForm(r.raw);d.value.avatar=((u=o.data.result)==null?void 0:u.url)+"",(_=B.value)==null||_.clearFiles()},$=()=>{var r;(r=h.value)==null||r.validate(async o=>{o&&H.confirm("确定修改个人基础信息？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await w(R).apiSysUserBaseInfoPost(l.ruleFormBase)})})},ee=(r,o,u)=>{l.passwordNew2!=l.ruleFormPassword.passwordNew?u(new Error("两次密码不一致！")):u()},le=()=>{l.ruleFormPassword.passwordOld="",l.ruleFormPassword.passwordNew="",l.passwordNew2=""},ae=()=>{var r;(r=T.value)==null||r.validate(async o=>{o&&(await w(R).apiSysUserChangePwdPost(l.ruleFormPassword),H.confirm("密码已修改，是否重新登录系统？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{Ue()}))})},oe=()=>{var r;l.cropperTitle="更换头像",(r=O.value)==null||r.openDialog(d.value.avatar)},se=()=>{l.avatarLoading=!0},te=()=>{l.avatarLoading=!1},re=r=>{x.value.clearFiles();const o=r[0];o.uid=ke(),x.value.handleStart(o)};return N({uploadAvatarFile:Z,handleChangeSignFile:J}),(r,o)=>{const u=t("el-avatar"),_=t("ele-School"),P=t("el-icon"),ne=t("ele-Mug"),de=t("ele-LocationInformation"),ie=t("el-image"),g=t("el-button"),ue=t("el-upload"),E=t("el-card"),c=t("el-col"),f=t("el-input"),p=t("el-form-item"),pe=t("el-date-picker"),M=t("el-radio"),me=t("el-radio-group"),z=t("el-row"),I=t("el-tab-pane"),ce=t("el-tabs"),_e=t("ele-EditPen"),fe=t("VueSignaturePad"),ge=t("el-input-number"),ve=t("el-color-picker"),we=t("el-dialog"),L=Y("loading"),U=Y("auth");return F(),he("div",Te,[e(z,{gutter:8,style:{width:"100%"}},{default:a(()=>[e(c,{span:8,xs:24},{default:a(()=>[e(E,{shadow:"hover"},{default:a(()=>[n("div",Oe,[V(e(u,{size:100,src:v(d).avatar,onClick:oe,"element-loading-spinner":"el-icon-Upload","element-loading-background":"rgba(0, 0, 0, 0.2)",onMouseenter:se,onMouseleave:te},null,8,["src"]),[[L,l.avatarLoading]]),n("div",Ae,k(v(d).realName),1)]),n("div",Ee,[n("p",null,[e(P,null,{default:a(()=>[e(_)]),_:1}),i(),n("span",null,k(v(d).orgName??"超级管理员"),1)]),n("p",null,[e(P,null,{default:a(()=>[e(ne)]),_:1}),i(),n("span",null,k(v(d).posName??"超级管理员"),1)]),n("p",null,[e(P,null,{default:a(()=>[e(de)]),_:1}),i(),n("span",null,k(v(d).address??"家庭住址"),1)])]),n("div",Me,[e(ie,{src:v(d).signature,fit:"contain",alt:"电子签名",loading:"lazy",style:{width:"100%",height:"100%"}},null,8,["src"])]),V((F(),S(g,{icon:"ele-Edit",type:"primary",onClick:K},{default:a(()=>[i(" 电子签名 ")]),_:1})),[[U,"sysFile:uploadSignature"]]),e(ue,{ref_key:"uploadSignRef",ref:x,action:"",accept:".png",limit:1,"show-file-list":!1,"auto-upload":!1,"on-change":j,"on-exceed":re,style:{display:"inline-block","margin-left":"12px",position:"absolute"}},{default:a(()=>[V((F(),S(g,{icon:"ele-UploadFilled"},{default:a(()=>[i("上传手写签名")]),_:1})),[[U,"sysFile:uploadSignature"]])]),_:1},512)]),_:1})]),_:1}),V((F(),S(c,{span:16,xs:24},{default:a(()=>[e(E,{shadow:"hover"},{default:a(()=>[e(ce,null,{default:a(()=>[e(I,{label:"基础信息"},{default:a(()=>[e(v(W),{model:l.ruleFormBase,ref_key:"ruleFormBaseRef",ref:h,size:"default","label-width":"100px"},{default:a(()=>[e(z,{gutter:35},{default:a(()=>[e(c,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:a(()=>[e(p,{label:"真实姓名",prop:"realName",rules:[{required:!0,message:"真实姓名不能为空",trigger:"blur"}]},{default:a(()=>[e(f,{modelValue:l.ruleFormBase.realName,"onUpdate:modelValue":o[0]||(o[0]=s=>l.ruleFormBase.realName=s),placeholder:"真实姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:a(()=>[e(p,{label:"昵称",prop:"nickName"},{default:a(()=>[e(f,{modelValue:l.ruleFormBase.nickName,"onUpdate:modelValue":o[1]||(o[1]=s=>l.ruleFormBase.nickName=s),placeholder:"昵称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:a(()=>[e(p,{label:"手机号码",prop:"phone",rules:[{required:!0,message:"手机号码不能为空",trigger:"blur"}]},{default:a(()=>[e(f,{modelValue:l.ruleFormBase.phone,"onUpdate:modelValue":o[2]||(o[2]=s=>l.ruleFormBase.phone=s),placeholder:"手机号码",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:a(()=>[e(p,{label:"邮箱",prop:"email"},{default:a(()=>[e(f,{modelValue:l.ruleFormBase.email,"onUpdate:modelValue":o[3]||(o[3]=s=>l.ruleFormBase.email=s),placeholder:"邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:a(()=>[e(p,{label:"出生日期",prop:"birthday",rules:[{required:!0,message:"出生日期不能为空",trigger:"blur"}]},{default:a(()=>[e(pe,{modelValue:l.ruleFormBase.birthday,"onUpdate:modelValue":o[4]||(o[4]=s=>l.ruleFormBase.birthday=s),type:"date",placeholder:"出生日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:a(()=>[e(p,{label:"性别",prop:"sex"},{default:a(()=>[e(me,{modelValue:l.ruleFormBase.sex,"onUpdate:modelValue":o[5]||(o[5]=s=>l.ruleFormBase.sex=s)},{default:a(()=>[e(M,{label:1},{default:a(()=>[i("男")]),_:1}),e(M,{label:2},{default:a(()=>[i("女")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(c,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:a(()=>[e(p,{label:"地址",prop:"nation"},{default:a(()=>[e(f,{modelValue:l.ruleFormBase.address,"onUpdate:modelValue":o[6]||(o[6]=s=>l.ruleFormBase.address=s),placeholder:"地址",clearable:"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:a(()=>[e(p,{label:"备注",prop:"remark"},{default:a(()=>[e(f,{modelValue:l.ruleFormBase.remark,"onUpdate:modelValue":o[7]||(o[7]=s=>l.ruleFormBase.remark=s),placeholder:"备注",clearable:"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:a(()=>[e(p,null,{default:a(()=>[V((F(),S(g,{icon:"ele-SuccessFilled",type:"primary",onClick:$},{default:a(()=>[i(" 保存基本信息 ")]),_:1})),[[U,"sysUser:baseInfo"]])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(I,{label:"组织机构"},{default:a(()=>[e(Ce,{ref:"orgTreeRef"},null,512)]),_:1}),e(I,{label:"修改密码"},{default:a(()=>[e(v(W),{ref_key:"ruleFormPasswordRef",ref:T,model:l.ruleFormPassword,"status-icon":"","label-width":"80px"},{default:a(()=>[e(p,{label:"当前密码",prop:"passwordOld",rules:[{required:!0,message:"当前密码不能为空",trigger:"blur"}]},{default:a(()=>[e(f,{modelValue:l.ruleFormPassword.passwordOld,"onUpdate:modelValue":o[8]||(o[8]=s=>l.ruleFormPassword.passwordOld=s),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(p,{label:"新密码",prop:"passwordNew",rules:[{required:!0,message:"新密码不能为空",trigger:"blur"}]},{default:a(()=>[e(f,{modelValue:l.ruleFormPassword.passwordNew,"onUpdate:modelValue":o[9]||(o[9]=s=>l.ruleFormPassword.passwordNew=s),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(p,{label:"确认密码",prop:"passwordNew2",rules:[{validator:ee,required:!0,trigger:"blur"}]},{default:a(()=>[e(f,{modelValue:l.passwordNew2,"onUpdate:modelValue":o[10]||(o[10]=s=>l.passwordNew2=s),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["rules"]),e(p,null,{default:a(()=>[e(g,{icon:"ele-Refresh",onClick:le,size:"default"},{default:a(()=>[i("重 置")]),_:1}),V((F(),S(g,{icon:"ele-SuccessFilled",type:"primary",onClick:ae,size:"default"},{default:a(()=>[i("确 定")]),_:1})),[[U,"sysUser:changePwd"]])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})]),_:1})),[[L,l.loading]])]),_:1}),e(we,{modelValue:l.signDialogVisible,"onUpdate:modelValue":o[13]||(o[13]=s=>l.signDialogVisible=s),draggable:"",width:"600px"},{header:a(()=>[n("div",ze,[e(P,{size:"16",style:{"margin-right":"3px",display:"inline","vertical-align":"middle"}},{default:a(()=>[e(_e)]),_:1}),Le])]),footer:a(()=>[n("span",Ge,[e(g,{onClick:X},{default:a(()=>[i("撤销")]),_:1}),e(g,{onClick:A},{default:a(()=>[i("清屏")]),_:1}),e(g,{type:"primary",onClick:Q},{default:a(()=>[i("保存")]),_:1})])]),default:a(()=>[n("div",Ye,[e(fe,{ref_key:"signaturePadRef",ref:m,options:l.signOptions,style:{"background-color":"#fff"}},null,8,["options"])]),n("div",qe,[n("div",We,[i("画笔粗细："),e(ge,{modelValue:l.signOptions.minWidth,"onUpdate:modelValue":o[11]||(o[11]=s=>l.signOptions.minWidth=s),min:.5,max:2.5,step:.1,size:"small"},null,8,["modelValue","min","max","step"])]),n("div",He,[i("画笔颜色："),e(ve,{modelValue:l.signOptions.penColor,"onUpdate:modelValue":o[12]||(o[12]=s=>l.signOptions.penColor=s),"color-format":"hex",size:"default"},null,8,["modelValue"])])])]),_:1},8,["modelValue"]),e(Ne,{ref_key:"cropperDialogRef",ref:O,title:l.cropperTitle},null,8,["title"])])}}});const sl=De(Qe,[["__scopeId","data-v-04d495dd"]]);export{sl as default};
