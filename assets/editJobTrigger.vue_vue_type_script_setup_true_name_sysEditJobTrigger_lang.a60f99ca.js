import{E as h,f as U,e as le}from"./index.96b44ad7.js";import oe from"./index.db638cf0.js";import{S as Y}from"./sys-job-api.2554cdf0.js";import{K as E,r as re,a1 as N,l as O,ak as n,o as c,a as M,Y as e,S as l,b as f,X as x,W as d,R as w,u as S,G as R,F as te,ab as ae}from"./vue.e20a9695.js";const ne={class:"sys-jobTrigger-container"},se={style:{color:"#fff"}},ue={class:"dialog-footer"},de={style:{color:"#fff"}},me=f("span",null," Cron表达式生成器 ",-1),ie=E({name:"sysEditJobTrigger"}),_e=E({...ie,props:{title:String},setup(H,{expose:J}){const P=H,k=re(),o=N({isShowDialog:!1,ruleForm:{},showCronDialog:!1}),z=N([{key:"@secondly",description:"每秒 .0000000"},{key:"@minutely",description:"每分钟 00"},{key:"@hourly",description:"每小时 00:00"},{key:"@daily",description:"每天 00:00:00"},{key:"@monthly",description:"每月 1 号 00:00:00"},{key:"@weekly",description:"每周日 00:00:00"},{key:"@yearly",description:"每年 1 月 1 号 00:00:00"},{key:"@workday",description:"每周一至周五 00:00:00"}]),_=O({get(){if(o.ruleForm.triggerType!="Furion.Schedule.PeriodTrigger"||!o.ruleForm.args)return;const r=Number(o.ruleForm.args);if(!Number.isNaN(r))return r},set(a){o.ruleForm.args=String(a)}}),i=O({get(){const a="";if(o.ruleForm.triggerType!="Furion.Schedule.CronTrigger"||!o.ruleForm.args)return a;const m=String(o.ruleForm.args).split(",");return m.length!=2?a:m[0].replace(new RegExp('"',"gm"),"").trim()},set(a){if(o.ruleForm.args==a)return;const r=a.trim();let m=-1;r.startsWith("@")?m=0:r.split(" ").length==6?m=2:m=3,o.ruleForm.args=`"${r}",${m}`}}),I=a=>{o.ruleForm=JSON.parse(JSON.stringify(a)),o.isShowDialog=!0},B=()=>{le.emit("submitRefresh"),o.isShowDialog=!1},$=()=>{o.isShowDialog=!1},A=()=>{k.value.validate(async a=>{if(a){if(o.ruleForm.triggerType=="Furion.Schedule.PeriodTrigger"&&!_.value){h.warning("间隔时间不能为空");return}else if(o.ruleForm.triggerType=="Furion.Schedule.CronTrigger"&&!i.value){h.warning("Cron表达式不能为空");return}o.ruleForm.id!=null&&o.ruleForm.id>0?await U(Y).apiSysJobUpdateJobTriggerPost(o.ruleForm):await U(Y).apiSysJobAddJobTriggerPost(o.ruleForm),B()}})},q=a=>{i.value=a==null||a==null?"":a},W=a=>{i.value=a.key};return J({openDialog:I}),(a,r)=>{const m=n("ele-Edit"),y=n("el-icon"),V=n("el-input"),u=n("el-form-item"),s=n("el-col"),v=n("el-option"),j=n("el-select"),g=n("el-input-number"),b=n("el-button"),T=n("el-row"),G=n("el-dropdown-item"),K=n("el-dropdown-menu"),L=n("el-dropdown"),D=n("el-date-picker"),p=n("el-radio"),F=n("el-radio-group"),X=n("SvgIcon"),Q=n("el-tooltip"),Z=n("el-form"),C=n("el-dialog");return c(),M("div",ne,[e(C,{modelValue:o.isShowDialog,"onUpdate:modelValue":r[15]||(r[15]=t=>o.isShowDialog=t),draggable:"","close-on-click-modal":!1,width:"769px"},{header:l(()=>[f("div",se,[e(y,{size:"16",style:{"margin-right":"3px",display:"inline","vertical-align":"middle"}},{default:l(()=>[e(m)]),_:1}),f("span",null,x(P.title),1)])]),footer:l(()=>[f("span",ue,[e(b,{onClick:$,size:"default"},{default:l(()=>[d("取 消")]),_:1}),e(b,{type:"primary",onClick:A,size:"default"},{default:l(()=>[d("确 定")]),_:1})])]),default:l(()=>[e(Z,{model:o.ruleForm,ref_key:"ruleFormRef",ref:k,size:"default","label-width":"130px"},{default:l(()=>[e(T,{gutter:35},{default:l(()=>[e(s,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:l(()=>[e(u,{label:"触发器编号",prop:"triggerId",rules:[{required:!0,message:"触发器编号不能为空",trigger:"blur"}]},{default:l(()=>[e(V,{modelValue:o.ruleForm.triggerId,"onUpdate:modelValue":r[0]||(r[0]=t=>o.ruleForm.triggerId=t),placeholder:"触发器编号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:l(()=>[e(u,{label:"触发器类型"},{default:l(()=>[e(j,{modelValue:o.ruleForm.triggerType,"onUpdate:modelValue":r[1]||(r[1]=t=>o.ruleForm.triggerType=t),style:{width:"100%"}},{default:l(()=>[e(v,{value:"Furion.Schedule.PeriodTrigger",label:"间隔"}),e(v,{value:"Furion.Schedule.CronTrigger",label:"Cron表达式"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),o.ruleForm.triggerType=="Furion.Schedule.PeriodTrigger"?(c(),w(s,{key:0,xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:l(()=>[e(u,{label:"间隔时间(ms)"},{default:l(()=>[e(g,{modelValue:S(_),"onUpdate:modelValue":r[2]||(r[2]=t=>R(_)?_.value=t:null),placeholder:"间隔",min:100,step:100,class:"w100"},null,8,["modelValue"])]),_:1})]),_:1})):(c(),w(s,{key:1,xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:l(()=>[e(u,{label:"Cron表达式"},{default:l(()=>[e(V,{modelValue:S(i),"onUpdate:modelValue":r[4]||(r[4]=t=>R(i)?i.value=t:null),placeholder:"Cron表达式"},{append:l(()=>[e(L,{style:{color:"inherit"},trigger:"click",onCommand:W},{dropdown:l(()=>[e(K,null,{default:l(()=>[(c(!0),M(te,null,ae(z,(t,ee)=>(c(),w(G,{key:ee,command:t},{default:l(()=>[e(T,{style:{width:"240px"}},{default:l(()=>[e(s,{span:9},{default:l(()=>[d(x(t.key),1)]),_:2},1024),e(s,{span:15},{default:l(()=>[d(x(t.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["command"]))),128))]),_:1})]),default:l(()=>[e(b,{style:{margin:"0px -10px 0px -20px",color:"inherit"}},{default:l(()=>[d(" Macro ")]),_:1})]),_:1}),e(b,{style:{margin:"0px -20px 0px -10px"},onClick:r[3]||(r[3]=t=>o.showCronDialog=!0)},{default:l(()=>[d("Cron表达式")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})),e(s,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:l(()=>[e(u,{label:"起始时间"},{default:l(()=>[e(D,{modelValue:o.ruleForm.startTime,"onUpdate:modelValue":r[5]||(r[5]=t=>o.ruleForm.startTime=t),type:"datetime",placeholder:"起始时间",style:{width:"100%"},format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:l(()=>[e(u,{label:"结束时间"},{default:l(()=>[e(D,{modelValue:o.ruleForm.endTime,"onUpdate:modelValue":r[6]||(r[6]=t=>o.ruleForm.endTime=t),type:"datetime",placeholder:"结束时间",style:{width:"100%"},format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:l(()=>[e(u,{label:"最大触发次数"},{default:l(()=>[e(g,{modelValue:o.ruleForm.maxNumberOfRuns,"onUpdate:modelValue":r[7]||(r[7]=t=>o.ruleForm.maxNumberOfRuns=t),placeholder:"最大触发次数",class:"w100"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:l(()=>[e(u,{label:"最大出错次数"},{default:l(()=>[e(g,{modelValue:o.ruleForm.maxNumberOfErrors,"onUpdate:modelValue":r[8]||(r[8]=t=>o.ruleForm.maxNumberOfErrors=t),placeholder:"最大出错次数",class:"w100"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:l(()=>[e(u,{label:"重试次数"},{default:l(()=>[e(g,{modelValue:o.ruleForm.numRetries,"onUpdate:modelValue":r[9]||(r[9]=t=>o.ruleForm.numRetries=t),placeholder:"重试次数",class:"w100"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:l(()=>[e(u,{label:"重试间隔(ms)"},{default:l(()=>[e(g,{modelValue:o.ruleForm.retryTimeout,"onUpdate:modelValue":r[10]||(r[10]=t=>o.ruleForm.retryTimeout=t),placeholder:"重试间隔ms",class:"w100"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:l(()=>[e(u,{label:"立即启动"},{default:l(()=>[e(F,{modelValue:o.ruleForm.startNow,"onUpdate:modelValue":r[11]||(r[11]=t=>o.ruleForm.startNow=t)},{default:l(()=>[e(p,{label:!0},{default:l(()=>[d("是")]),_:1}),e(p,{label:!1},{default:l(()=>[d("否")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:l(()=>[e(u,{label:"启动时执行一次"},{default:l(()=>[e(F,{modelValue:o.ruleForm.runOnStart,"onUpdate:modelValue":r[12]||(r[12]=t=>o.ruleForm.runOnStart=t)},{default:l(()=>[e(p,{label:!0},{default:l(()=>[d("是")]),_:1}),e(p,{label:!1},{default:l(()=>[d("否")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:l(()=>[e(u,null,{label:l(()=>[f("div",null,[d(" 重置触发次数 "),e(Q,{"raw-content":"",content:"是否在启动时重置最大触发次数等于一次的作业<br/>解决因持久化数据已完成一次触发但启动时不再执行的问题",placement:"top"},{default:l(()=>[e(X,{name:"fa fa-question-circle-o",size:16,style:{"vertical-align":"middle"}})]),_:1})])]),default:l(()=>[e(F,{modelValue:o.ruleForm.resetOnlyOnce,"onUpdate:modelValue":r[13]||(r[13]=t=>o.ruleForm.resetOnlyOnce=t)},{default:l(()=>[e(p,{label:!0},{default:l(()=>[d("是")]),_:1}),e(p,{label:!1},{default:l(()=>[d("否")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:l(()=>[e(u,{label:"描述信息",prop:"description"},{default:l(()=>[e(V,{modelValue:o.ruleForm.description,"onUpdate:modelValue":r[14]||(r[14]=t=>o.ruleForm.description=t),placeholder:"描述信息",clearable:"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(C,{modelValue:o.showCronDialog,"onUpdate:modelValue":r[17]||(r[17]=t=>o.showCronDialog=t),draggable:"","close-on-click-modal":!1,class:"scrollbar"},{header:l(()=>[f("div",de,[e(y,{size:"16",style:{"margin-right":"3px",display:"inline","vertical-align":"middle"}},{default:l(()=>[e(m)]),_:1}),me])]),default:l(()=>[e(oe,{onHide:r[16]||(r[16]=t=>o.showCronDialog=!1),onFill:q,expression:S(i)},null,8,["expression"])]),_:1},8,["modelValue"])])}}});export{_e as _};
